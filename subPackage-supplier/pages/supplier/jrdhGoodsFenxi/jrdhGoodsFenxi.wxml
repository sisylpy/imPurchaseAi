<wxs src="../../../../utils/fn.wxs" module="tool" />


<view class="flex flex-column">
  <back-navbar style="height: {{navBarHeight}}rpx;" title="{{supplierInfo.nxJrdhsSupplierName}}" avatar="/images/back-gray.png" button-text="设置" bindnavbuttontap="toBack"></back-navbar>

  <!--  top -->
  <view class=" flex-row-between pr-10 pl-10 border-bottom-shadow bg-white">
    <view class="flex-row">
      <view class="p-20" bindtap="toDatePage">
        <image src="../../../../images/calender.png" class="icon"></image>
      </view>
      <view class="flex-column">
        <view class="flex-row" wx:if="{{startDate == stopDate}}">
          <view class="font-sm" wx:if="{{startDate}}"> {{tool.transferDateString(startDate)}}</view>
        </view>
        <view class="flex-row" wx:else>
          <view class=" font-sm" wx:if="{{startDate}}"> {{tool.transferDateString(startDate)}}</view>
          <text class="p-10">-</text>
          <view class=" font-sm" wx:if="{{stopDate}}">{{tool.transferDateString(stopDate)}}</view>
        </view>
      </view>
    </view>

    <view class="flex-row p-20" bindtap="showSearch">
      <image src="{{type !== 'goods' ? '../../../../images/filter.png' : '../../../../images/filter-3-fill.png'}}" class="icon mr-20"></image>
    </view>

  </view>





  <block wx:if="{{arr.length > 0}}">


    <view class="flex-column p-20">

      <!-- 每日进货总额图表 -->
      <view class="flex-column bg-white radius-10 border p-20">


        <view class="flex-column p-20">
          <view class="flex-row font-md">
            <text class="mr-10">采购总额:</text>
            <text class="font-bold">{{supplierItem.purGoodsTotalString}}元</text>
          </view>
          <view class="flex-row half-row">
            <text class="mr-10">进货商品:</text>
            <text class="font-bold">{{supplierItem.billCount}}个</text>
          </view>

        </view>
        <view class="flex-column p-20" style="height: 340rpx;">
          <view class="font-xs">日进货总额</view>
          <ec-canvas id="dailyChart" canvas-id="dailyChart" ec="{{ ecDaily }}"></ec-canvas>
        </view>



        <view class="flex-column  mt-30 mb-30">

          <!-- 环形饼状图 -->
          <view class="flex-row-default mt-30">
            <!-- 图表区域 -->
            <view class="flex-column p-20" style="width: {{windowWidth * 0.6}}rpx; height: 380rpx; ">
              <view class="font-xs">成本比例</view>

              <ec-canvas id="amountChart" canvas-id="mychart-bar" ec="{{ ecT }}"></ec-canvas>
            </view>

            <!-- 图例区域 -->
            <view class="flex-column" style="width: {{windowWidth * 0.4 - 40}}rpx;">
              <view style="height: 60rpx;"> </view>
              <view class="flex-row-default p-10">
                <view class="legend-color mt-10" style="background-color: #007aff;"></view>
                <view class="flex-column">
                  <view class="legend-label">库存金额</view>
                  <view class="legend-value">{{supplierItem.stockGoodsTotalString}}元</view>
                </view>
              </view>
              <view class="flex-row-default p-10">
                <view class="legend-color mt-10" style="background-color: #66bb6a;"></view>
                <view class="flex-column">
                  <view class="legend-label">销售金额</view>
                  <view class="legend-value">{{supplierItem.produceGoodsTotalString}}元</view>
                </view>
              </view>
              <view class="flex-row-default p-10">
                <view class="legend-color mt-10" style="background-color: #ffa726;"></view>
                <view class="flex-column">
                  <view class="legend-label">损耗金额</view>
                  <view class="legend-value">{{supplierItem.lossGoodsTotalString}}元</view>
                </view>
              </view>
              <view class="flex-row-default p-10">
                <view class="legend-color mt-10" style="background-color: #ff6b6b;"></view>
                <view class="flex-column">
                  <view class="legend-label">废弃金额</view>
                  <view class="legend-value">{{supplierItem.wasteGoodsTotalString}}元</view>
                </view>
              </view>
              <view class="flex-row-default p-10">
                <view class="legend-color  mt-10" style="background-color: #000;"></view>
                <view class="flex-column">
                  <view class="legend-label">退货金额</view>
                  <view class="legend-value">{{supplierItem.returnGoodsTotalString}}元</view>
                </view>
              </view>

            </view>
          </view>


        </view>



      </view>


      <view class="flex-column p-10">


        <view class="flex-column  border-bottom p-20 bg-white mb-20" wx:for-item="goods" wx:key="gbDepartmentGoodsId" wx:for-index="depGoodsIndex" wx:for="{{arr}}" bind:tap="toFenxi"
         data-id="{{goods.gbDistributerGoodsId}}" data-goods="{{goods}}" hover-class="hover">

          <view class="flex-row-default">
            <image bindtap="showDialogBtn" data-item="{{goods}}" src="{{url + goods.gbDgNxFatherImg}}" mode="aspectFill" class="url_item mr-20" />
            <view class="flex-column" style="width: {{windowWidth - 220}}rpx; ">
              <view class="flex-row-wrap font-md" style="width: {{windowWidth - 220}}rpx;">
                <text class="font-md ">{{goods.gbDgGoodsName}}</text>
                <block wx:if="{{goods.gbDistributerAliasEntities.length > 0}}">
                  <text class="font-sm" wx:for="{{goods.gbDistributerAliasEntities}}" wx:for-item="alias">@{{alias.gbDaAliasName}}</text>
                </block>
                <block wx:if="{{goods.gbDgGoodsStandardWeight.length > 0}}">
                  <view class="">
                    ({{goods.gbDgGoodsStandardWeight}}/{{goods.gbDgGoodsStandardname}})
                  </view>
                </block>

                <block wx:else>
                  <text class="ml-10 ">({{goods.gbDgGoodsStandardname}})</text>
                </block>
              </view>

              <view class="flex-row font-sm">
                <view class="flex-row half-row" wx:if="{{goods.gbDgGoodsDetail !== null && goods.gbDgGoodsDetail.length > 0}}">
                  <text class="text-secondary">说明:</text>
                  <text>{{goods.gbDgGoodsDetail}}</text>
                </view>
                <view class="flex-row" wx:if="{{goods.gbDgGoodsPlace !== null && goods.gbDgGoodsPlace.length > 0}}">
                  <text>产地:</text>
                  <text class="">{{goods.gbDgGoodsPlace}}</text>
                </view>
              </view>

              <view class="flex-row font-xs" style="width: {{windowWidth - 220}}rpx;">
                <view class="flex-row half-row">
                  <text class="mr-10 text-secondary">采购总额:</text>
                  <text class="">{{goods.gbDgSellingPrice}}元</text>
                </view>
                <view class="flex-row half-row">
                  <text class="mr-10 text-secondary">采购数量:</text>
                  <text class="">{{goods.gbDgSelfPrice}}{{goods.gbDgGoodsStandardname}}</text>
                </view>
              </view>

              <view class="flex-row font-xs">
                <view class="flex-row half-row">
                  <text class="mr-10 text-secondary">最低单价:</text>
                  <text class="">{{goods.gbDgGoodsLowestPrice}}元/{{goods.gbDgGoodsStandardname}}</text>
                </view>
                <view class="flex-row half-row">
                  <text class="mr-10 text-secondary">最高单价:</text>
                  <text class="">{{goods.gbDgGoodsHighestPrice}}元/{{goods.gbDgGoodsStandardname}}</text>
                </view>
              </view>

              <view class="flex-row font-xs">
                <view class="flex-row half-row">
                  <text class="mr-10 text-secondary">平均单价:</text>
                  <text class="">{{goods.gbDgGoodsAveragePrice}}元/{{goods.gbDgGoodsStandardname}}</text>
                </view>
                <view class="flex-row half-row">
                  <text class="mr-10 text-secondary">采购次数:</text>
                  <text class="">{{goods.goodsPurTotalCount}}次</text>
                </view>
              </view>

            </view>

          </view>


          <!--  -->
          <view class="flex-column">
            <view class="" style="width: {{windowWidth - 100}}rpx; height: 300rpx; ">

              <ec-canvas id="mychartTop{{goods.gbDistributerGoodsId}}" canvas-id="mychart-bar" ec="{{ eca }}"></ec-canvas>

            </view>
          </view>

         


        </view>




      </view>

      <!-- 分页提示 -->
      <view class="font-sm center-content flex-column p-20" wx:if="{{arr.length > 0}}">
        <view class="flex-row">
          <text class="text-secondary">共 {{totalCount}} 条记录，第 {{currentPage}}/{{totalPage}} 页</text>
        </view>
        <view class="flex-row mt-10" wx:if="{{currentPage < totalPage}}">
          <text class="text-secondary">上拉加载更多</text>
        </view>
        <view class="flex-row mt-10" wx:if="{{currentPage >= totalPage}}">
          <text class="text-secondary">已加载全部数据</text>
        </view>
      </view>

      <view class="font-sm center-content flex-column "  wx:if="{{currentPage == totalPage}}">
        <view class="flex-row">
          <image src="{{url + '/userImage/daodile3.png'}}" mode="aspectFill" class="icon-lg margin-right" />
          <view style="line-height: 200rpx;">没有数据啦!</view>
        </view>

      </view>

    </view>


  </block>

  <view class="{{arr.length == 0 ? 'show' : 'hide'}}" style="height: {{windowHeight - 360}}rpx;">

    <view class="center-content flex-column" style="padding-top: 200rpx;">
      <image class="empty_image" src="/images/cart-Empty.png"></image>
      <text class="big">无数据</text>
    </view>

  </view>
  <!-- ./empty -->

</view>



<view class="overlay {{showStar ? 'show' : 'hide'}}" bind:tap="hideMask">

  <view class="flex-column font-md popup p-20">
    <view class="flex-row p-20">
      <text>{{showGoods.gbDgGoodsName}}</text>
      <text>({{showGoods.gbDgGoodsStandardname}})</text>
    </view>

    <view class="flex-column p-30">
      <view class="flex-row p-10" wx:if="{{showGoods.goodsData.starsCount.starsFive > 0}}">
        <view class="flex-row-default" style="width: {{windowWidth / 6}}rpx; ">
          <image wx:for="11111" src="/images/starGreen.png" mode="aspectFill" class="icon-sm" />
        </view>

        <text class="ml-20">{{showGoods.goodsData.starsCount.starsFive}}次</text>
      </view>


      <view class="flex-row  p-10" wx:if="{{showGoods.goodsData.starsCount.starsFour > 0}}">

        <view class="flex-row-default" style="width: {{windowWidth / 6}}rpx; ">
          <image wx:for="1111" src="/images/starGreen.png" mode="aspectFill" class="icon-sm" />
          <image src="/images/starGray.png" mode="aspectFill" class="icon-sm" />
        </view>
        <text class="ml-20">{{showGoods.goodsData.starsCount.starsFour}}次</text>
      </view>


      <view class="flex-row  p-10" wx:if="{{showGoods.goodsData.starsCount.starsThree > 0}}">
        <view class="flex-row-default" style="width: {{windowWidth / 6}}rpx; ">
          <image wx:for="111" src="/images/starGreen.png" mode="aspectFill" class="icon-sm" />
          <image wx:for="11" src="/images/starGray.png" mode="aspectFill" class="icon-sm" />
        </view>
        <text class="ml-20">{{showGoods.goodsData.starsCount.starsThree}}次</text>
      </view>


      <view class="flex-row  p-10" wx:if="{{showGoods.goodsData.starsCount.starsTwo > 0}}">
        <view class="flex-row-default" style="width: {{windowWidth / 6}}rpx; ">
          <image wx:for="11" src="/images/starGreen.png" mode="aspectFill" class="icon-sm" />
          <image wx:for="111" src="/images/starGray.png" mode="aspectFill" class="icon-sm" />

        </view>
        <text class="ml-20">{{showGoods.goodsData.starsCount.starsTwo}}次</text>
      </view>
      <view class=" p-10 flex-row" wx:if="{{showGoods.goodsData.starsCount.starsOne > 0}}">
        <image src="/images/starGreen.png" mode="aspectFill" class="icon-sm" />
        <image wx:for="1111" src="/images/starGray.png" mode="aspectFill" class="icon-sm" />
        <text class="ml-20">{{showGoods.goodsData.starsCount.starsOne}}次</text>
      </view>

    </view>

  </view>
</view>


<view class="overlay {{showSearch ? 'show' : 'hide'}}" catch:tap="hideMask">
  <view class="flex-column nnn bg-white font-md">


    <view class="flex-row p-30  border-bottom" catch:tap="searchData" data-type="money" data-string="按采购金额">
      <image src="/images/arrow-right-3.png" mode="aspectFill" class="icon mr-20" />
      <text>按采购金额</text>
    </view>
    <view class="flex-row p-30  border-bottom" catch:tap="searchData" data-type="times" data-string="按采购数量">
      <image src="/images/arrow-right-3.png" mode="aspectFill" class="icon mr-20" />
      <text>按采购次数</text>
    </view>


    <view style="height: 20rpx;"></view>



  </view>


</view>
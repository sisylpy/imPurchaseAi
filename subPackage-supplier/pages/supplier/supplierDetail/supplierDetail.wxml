<wxs src="../../../../utils/fn.wxs" module="tool" />

<view class="flex-column">


  <back-navbar title="供货商" avatar="/images/back-gray.png" button-text="设置" bindnavbuttontap="toBack"></back-navbar>

  <!--  top -->
  <view class=" flex-row-between pr-10 pl-10 border-bottom-shadow bg-white" style="margin-top: {{navBarHeight}}rpx;">
    <view class="flex-row">
      <view class="p-20" bindtap="toDatePage">
        <image src="/images/calender.png" class="icon"></image>
      </view>
      <view class="flex-column">
        <view class="flex-row" wx:if="{{startDate == stopDate}}">
          <view class=" small"> {{tool.transferDateString(startDate)}}</view>

        </view>
        <view class="flex-row" wx:else>
          <view class=" small" wx:if="{{startDate}}"> {{tool.transferDateString(startDate)}}</view>
          <text class="p-10">-</text>
          <view class=" small" wx:if="{{stopDate}}">{{tool.transferDateString(stopDate)}}</view>
        </view>
      </view>
    </view>
    <view class="flex-row p-20" bindtap="toMyDate">
      <image src="{{searchDepIds == -1 ? '/images/filter.png' : '../../../../../images/filter-3-fill.png'}}" class="icon mr-20"></image>
    </view>
  </view>

  <view class="flex-column">


    <view class="flex-column" wx:if="{{totalSettle > 0}}">


      <view class="pb-20 pt-20">
        <!-- <text class="small p-20">未结账款</text> -->
        <view class="flex-column liziBack big_full_padding ">
          <text class="small gray">账款总额</text>
          <view class="flex-row-between">
            <view class="flex-row">
              <text class="excreambig mr-20">{{unSettleSubtotal}}</text> <text class="small">元</text>
            </view>
            <view class="mainBack settleBtn" bindtap="toSettleBills">结账</view>
          </view>
        </view>
      </view>

      <view class="flex-column p-20 " wx:for="{{billArr}}" wx:for-item="month" wx:if="{{month.arr.length > 0}}">
        <view class="flex-column border-bottom p-20 ">
          <text class="font-lg">{{month.month}}月</text>
          <view class="flex-row gray small">
            <text class="mr-10">订单</text>
            <text class="mr-10">{{month.arr.length}}个</text>
            <text class="mr-10">金额</text>
            <text>{{month.total}}元</text>
          </view>
        </view>

        <view class="flex-column p-20 border-bottom" wx:for="{{month.arr}}" wx:for-item="item" style="width: {{windowWidth - 40}}rpx; " hover-class="hover" bindtap="openBatchDetail" data-id="{{item.gbDistributerPurchaseBatchId}}">
          <block wx:if="{{item.gbDpbUserAdminType == 7}}">
            <view class="flex-row pink small">退货单</view>
          </block>
          <view class="flex-row-between">
            <view class="flex-column">
              <view class="flex-row " style="width: {{windowWidth - 140}}rpx; ">
                <view class="flex-row half-row">
                  <text class="mr-10">日期:</text>
                  <text class="mr-20">{{item.gbDpbDate}}</text>
                </view>
                <view class="flex-row half-row">
                  <text class="mr-10">卖方:</text>
                  <text> {{item.gbDistributerSupplierEntity.gbDistributerSupplierName}}</text>
                </view>
              </view>
              <view class="flex-row">
                <view class="flex-row half-row">
                  <text class="mr-10">金额:</text>
                  <text> {{item.gbDpbSubtotal}}元</text>
                </view>
                <view class="flex-row half-row">
                  <text class="mr-10">采购员:</text>
                  <text> {{tool.getAttrName(item.gbPurDepartmentUserEntity.gbDuWxNickName)}}</text>
                </view>
              </view>

              <view class="flex-row">
                <view class="flex-row half-row">
                  <text class="mr-10">付款方式:</text>
                  <text>{{item.gbDpbPayType == 0 ? '现金' :'记账'}}</text>
                </view>
                <view class="flex-row half-row">
                  <text class="mr-10">是否结账:</text>
                  <text wx:if="{{item.gbDpbStatus < 3}}" class=" font-xs red">未收到票据</text>
                  <text wx:elif="{{item.gbDpbStatus == 3}}" class="font-xs red">未结账</text>
                  <text wx:elif="{{item.gbDpbStatus == 4}}" class="font-xs gray">已结账</text>
                </view>

              </view>
            </view>
            <view>
              <image src="../../../../../images/arrow-right-3.png" class="icon pr-10 pl-10"></image>
            </view>
          </view>




        </view>

      </view>
    </view>


    <view class="emptyView" wx:else="" style="height: {{windowHeight - 760}}rpx; text-align:center;">
      <view class="empty_View center-content">
        <image class="empty_image" src="../../../../../images/file-empty.png"></image>
        <text class="big">暂无进货成本</text>
      </view>
    </view>

  </view>
</view>
<wxs src="../../../../utils/fn.wxs" module="tool" />

<view class="flex flex-column page-bg">

  <main-navbar style="height: {{navBarHeight + 110}}rpx;" title="{{userInfo.gbDuWxNickName}}" avatar="{{url + userInfo.gbDuWxAvartraUrl}}" button-text="设置" bindnavbuttontap="onNavButtonTap" bind:sortby="onSortByChange" bind:searchinput="onSearchInput" bind:searchcancel="onSearchCancel" searchValue="{{searchValue}}"></main-navbar>

  <view class="content flex-1 flex-column">

    <view class="flex-column-center">
      <view class="flex-row" style="padding: 10rpx 0; font-size: 34rpx; font-weight: 500;" bind:tap="{{depList.length > 1 ? 'toSwitchDep' : ''}}">
        <text class="mainColor font-bold  mr-10">{{depInfo.gbDepartmentName}}</text>
        <view class="p-10" hover-class="hover" wx:if="{{depList.length > 1}}">
          <image src="/images/switchDep.png" mode="aspectFill" class="icon mr-10" />
        </view>
        <text>订货单</text>

      </view>
    </view>

    <scroll-view scroll-y="true" class="scroll-content " show-scrollbar="true">
      <!-- 搜索结果蒙版 -->
      <view wx:if="{{searchArr !== null}}" class="search-mask" bindtap="onSearchCancel">
        <view class="search-result-list" catchtap="true">
          <view wx:if="{{searchArr.length > 0}}">
            <view class="p-10" wx:for="{{searchArr}}" wx:for-item="order" wx:key="gbDepartmentOrdersId">
              <view class="flex flex-row-between border-bottom p-10">
                <view class="flex font-md">
                  <text class="mr-10">{{index + 1}}</text>
                  <view class="flex-cloumn" style="width: {{windowWidth - 200}}rpx; ">
                    <view class="flex-row-wrap align-center">
                      <text class="brand" wx:if="{{order.gbDistributerGoodsEntity && order.gbDistributerGoodsEntity.gbDgGoodsBrand !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsBrand.length > 0}}">{{order.gbDistributerGoodsEntity.gbDgGoodsBrand}}</text>
                      <text class="font-bold mr-10">{{order.gbDistributerGoodsEntity.gbDgGoodsName}}</text>
                      <text class="font-sm" wx:if="{{order.gbDistributerGoodsEntity && order.gbDistributerGoodsEntity.gbDgGoodsPlace !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsPlace.length > 0}}">({{order.gbDistributerGoodsEntity.gbDgGoodsPlace}})</text>
                      <text class="font-sm" wx:if="{{order.gbDistributerGoodsEntity && order.gbDistributerGoodsEntity.gbDgGoodsDetail.length > 0 && order.gbDistributerGoodsEntity.gbDgGoodsDetail !==  'null'}}">{{order.gbDistributerGoodsEntity.gbDgGoodsDetail}}</text>
                      <text class="mr-20" wx:if="{{order.gbDoNxGoodsId !== null}}">({{order.gbDoPrintStandard}})</text>
                      <text class="mr-20 font-xs text-secondary" wx:else="">(临时商品)</text>
                      <text class="">订:{{order.gbDoQuantity}}{{order.gbDoStandard}}</text>
                      <text class="text-danger font-sl" wx:if="{{order.gbDoRemark !== null  && order.gbDoRemark.length > 0}}">({{order.gbDoRemark}})</text>
                    </view>
                    <view class="flex flex-row font-sl" wx:if="{{order.gbDoStatus == 2}}">
                      <view class="third-row">
                        <text class="text-secondary">出货:</text>
                        <text class="" wx:if="{{order.gbDoWeight !== null}}">{{order.gbDoWeight}}{{order.gbDoPrintStandard}}</text>
                      </view>
                      <view class="third-row">
                        <text class=" text-secondary">单价:</text>
                        <text class="" wx:if="{{order.gbDoPrice !== null}}">{{order.gbDoPrice}}/{{order.gbDoPrintStandard}}</text>
                      </view>
                      <view class="third-row" wx:if="{{order.gbDoSubtotal !== null || order.gbDoSubtotal == ''}}">
                        <text class="text-secondary">小计:</text>
                        <text class="">{{order.gbDoSubtotal}}元</text>
                      </view>
                    </view>
                  </view>
                </view>
                <view class="font-xs pt-20 pb-20" wx:if="{{order.gbDoBuyStatus == 3}}">
                  已称重
                </view>
                <view class="font-xs pt-20 pb-20" wx:elif="{{order.gbDoBuyStatus == 4}}">
                  <view class="bg-mainColor p-20 radius-20" bind:tap="receiveStock" data-item="{{order}}">收货</view>
                </view>
                <view class="p-10" wx:elif="{{order.gbDoBuyStatus == 5}}" bindtap="haveReceive">
                  已收货
                </view>
                <view wx:else="" class="button-container-white" catch:tap="toEditApply" data-order="{{order}}" data-item="{{order.gbDistributerGoodsEntity}}" data-goods="{{order.gbDistributerGoodsEntity}}" hover-class="hover">
                  <image src="../../../../images/edit.png" class="icon"></image>
                </view>
              </view>
            </view>
          </view>
          <view wx:else class="search-no-result">
            <view class="flex-column-center" style="height: 300rpx;">
              <view class="flex-column-center">
                <view>
                  <image src="/images/search.png" mode="aspectFill" class="url_item" style="width: 80rpx; height: 80rpx; opacity: 0.5;" />
                </view>
                <view class="font-bold font-lg-2 p-20">
                  <text>没有搜索到订单</text>
                </view>
                <view>
                  <text>请尝试其他关键词</text>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <!-- 订单数据 -->

      <block wx:if="{{showType == 'category'}}">


        <view class="flex-column-center" wx:if="{{applyArr.length == 0}}" style="height: {{windowHeight - navBarHeight - 400}}rpx; ">

          <view class="flex-column-center">

            <view>
              <image src="/images/cart-Empty.png" mode="aspectFill" class="url_item" />
            </view>
            <view class="font-bold font-lg-2 p-20">
              <text>暂无订货记录</text>
            </view>
            <view>
              <text>快来下第一单，开启今日采购吧!</text>
            </view>

          </view>

        </view>

        <view class="p-10" wx:for="{{applyArr}}" wx:for-item="father">
          <view class="flex-row font-xs" style="padding: 20rpx 20rpx 10rpx 20rpx; color: rgb(236, 135, 3);">{{father.gbDfgFatherGoodsName || '未分类'}}</view>
          <view class="" wx:for="{{father.gbDistributerGoodsEntities}}" wx:for-item="goods">
            <view class="flex flex-row-between  border-bottom p-10 {{order.gbDoBuyStatus < 3 ? 'liziBack' : 'bg-white'}}" wx:for="{{goods.gbDepartmentOrdersEntities}}" wx:for-item="order" wx:key="gbDepartmentOrdersId" wx:for-index="applyIndex">

              <block wx:if="{{order.gbDoStatus == -2}}">
                <view class="flex-row font-md new-goods-order">
                  <text class="mr-10">{{order.globalOrderIndex || (applyIndex + 1)}}.</text>
                  <view class="flex-cloumn" style="width: {{windowWidth - 160}}rpx; ">
                    <view class="flex-row-wrap align-center">
                      <text class="text-danger font-xs">[未知商品]</text>
                      <text class="brand" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsBrand !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsBrand.length > 0}}">{{order.gbDistributerGoodsEntity.gbDgGoodsBrand}}</text>
                      <text class="font-bold ">{{order.gbDoGoodsName}}</text>

                      <text class="" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsPlace !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsPlace.length > 0}}">{{order.gbDistributerGoodsEntity.gbDgGoodsPlace}}</text>

                      <text class="" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsDetail.length > 0 && order.gbDistributerGoodsEntity.gbDgGoodsDetail !==  'null'}}">{{order.gbDistributerGoodsEntity.gbDgGoodsDetail}}</text>

                      <text class="ml-20">订:{{order.gbDoQuantity}}{{order.gbDoStandard}}</text>
                      <text class="text-danger font-sl" wx:if="{{order.gbDoRemark !== null  && order.gbDoRemark.length > 0}}">({{order.gbDoRemark}})</text>
                    </view>

                  </view>
                </view>



                <view bindtap="openOperationLinshi" data-dep="{{dep.depInfo}}" data-order="{{order}}" data-id="{{order.gbDistributerGoodsEntity.gbDistributerGoodsId}}" data-name="{{order.gbDistributerGoodsEntity.gbDgGoodsName}}" data-goods="{{order.gbDistributerGoodsEntity}}" data-item="{{order.nxDistributerGoodsEntity}}" hover-class="hover" data-depid="{{dep.depId}}" class="p-10">
                  <image src="../../../../images/points.png" class="icon"></image>
                </view>

              </block>

              <block wx:else="">
                <view class="flex  font-md">
                  <text class="mr-10">{{order.globalOrderIndex}}.</text>
                  <view class="flex-cloumn" style="width: {{windowWidth - 200}}rpx; ">
                    <view class="flex-row-wrap align-center">
                      <text class="brand" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsBrand !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsBrand.length > 0}}">{{order.gbDistributerGoodsEntity.gbDgGoodsBrand}}</text>
                      <text class="font-bold mr-10">{{goods.gbDgGoodsName}}</text>

                      <text class="font-sm" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsPlace !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsPlace.length > 0}}">({{order.gbDistributerGoodsEntity.gbDgGoodsPlace}})</text>

                      <text class="font-sm" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsDetail.length > 0 && order.gbDistributerGoodsEntity.gbDgGoodsDetail !==  'null'}}">{{order.gbDistributerGoodsEntity.gbDgGoodsDetail}}</text>

                      <text class="mr-20" wx:if="{{order.gbDoNxGoodsId !== null}}">({{order.gbDoPrintStandard}})</text>
                      <text class="mr-20 font-xs text-secondary" wx:else="">(临时商品)</text>

                      <text class="">订:{{order.gbDoQuantity}}{{order.gbDoStandard}}</text>
                      <text class="text-danger font-sl" wx:if="{{order.gbDoRemark !== null  && order.gbDoRemark.length > 0}}">({{order.gbDoRemark}})</text>
                    </view>


                    <view class="flex flex-row font-sl" wx:if="{{order.gbDoStatus == 2}}">
                      <view class="third-row">
                        <text class="text-secondary">出货:</text>
                        <text class="" wx:if="{{order.gbDoWeight !== null}}">{{order.gbDoWeight}}{{order.gbDoPrintStandard}}</text>
                      </view>

                      <view class="third-row">
                        <text class=" text-secondary">单价:</text>
                        <text class="" wx:if="{{order.gbDoPrice !== null}}">{{order.gbDoPrice}}/{{order.gbDoPrintStandard}}</text>

                      </view>

                      <view class="third-row" wx:if="{{order.gbDoSubtotal !== null || order.gbDoSubtotal == '' }}">
                        <text class="text-secondary">小计:</text>
                        <text class="">{{order.gbDoSubtotal}}元</text>
                      </view>
                    </view>

                  </view>
                </view>

                <view class="font-xs pt-20 pb-20" wx:if="{{order.gbDoBuyStatus == 3}}">
                  已称重
                </view>
                <view class="font-xs pt-20 pb-20" wx:elif="{{order.gbDoBuyStatus == 4}}">
                  <view class="bg-mainColor p-20 radius-20" bind:tap="receiveStock" data-item="{{order}}">收货</view>
                </view>

                <view wx:else="" class="button-container-white" bindtap="toEditApply" data-order="{{order}}" data-subname="" data-id="{{order.gbDistributerGoodsEntity.gbDistributerGoodsId}}" data-name="{{order.gbDistributerGoodsEntity.gbDgGoodsName}}" data-type="goods" data-color="{{order.gbDistributerGoodsEntity.gbDgNxGoodsFatherColor}}" data-goods="{{order.gbDistributerGoodsEntity}}" hover-class="hover">
                  <image src="../../../../images/edit.png" class="icon"></image>
                </view>
              </block>

              <!-- ../arrow -->
            </view>

          </view>
        </view>

        <view class="p-20" style="height: 200rpx;" wx:if="{{applyArr.length > 0}}">
          <view class="p-20 text-secondary font-sl" style="text-align:center;">没有数据啦！</view>
        </view>

      </block>

      <block wx:if="{{showType == 'time'}}">

        <!--  -->
        <view class="flex-column-center" wx:if="{{applyArr.length == 0}}" style="height: {{windowHeight - navBarHeight - 400}}rpx; ">

          <view class="flex-column-center">

            <view>
              <image src="/images/cart-Empty.png" mode="aspectFill" class="url_item" />
            </view>
            <view class="font-bold font-lg-2 p-20">
              <text>暂无订货记录</text>
            </view>
            <view>
              <text>快来下第一单，开启今日采购吧!</text>
            </view>

          </view>

        </view>


        <block wx:for="{{applyArr}}" wx:for-item="order" wx:key="gbDepartmentOrdersId" wx:for-index="applyIndex" wx:if="{{applyArr.length > 0}}">

          <view wx:if="{{order.gbDoStatus == -2}}" class="flex flex-row-between  border-bottom p-10 bg-light new-goods-order"
          bindtap="openOperationLinshi" data-dep="{{dep.depInfo}}" data-order="{{order}}" data-id="{{order.gbDistributerGoodsEntity.gbDistributerGoodsId}}" data-name="{{order.gbDistributerGoodsEntity.gbDgGoodsName}}" data-goods="{{order.gbDistributerGoodsEntity}}" data-item="{{order.nxDistributerGoodsEntity}}" hover-class="hover" data-depid="{{dep.depId}}">

            <view class="flex-row font-md text-white pt-20 pb-20">
              <text class="mr-10">{{order.globalOrderIndex || (applyIndex + 1)}}.</text>
                <view class="flex-row-wrap " style="width: {{windowWidth - 260}}rpx;">
                  <text class="brand" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsBrand !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsBrand.length > 0}}">{{order.gbDistributerGoodsEntity.gbDgGoodsBrand}}</text>
                  <text class="font-bold ">{{order.gbDoGoodsName}}</text>
                  <text class="font-xs ml-10 text-danger">[未完成订单]</text>

                  <text class="" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsPlace !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsPlace.length > 0}}">{{order.gbDistributerGoodsEntity.gbDgGoodsPlace}}</text>

                  <text class="" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsDetail.length > 0 && order.gbDistributerGoodsEntity.gbDgGoodsDetail !==  'null'}}">{{order.gbDistributerGoodsEntity.gbDgGoodsDetail}}</text>



                  <text class="ml-20">订:{{order.gbDoQuantity}}{{order.gbDoStandard}}</text>
                  <text class="text-danger font-sl" wx:if="{{order.gbDoRemark !== null  && order.gbDoRemark.length > 0}}">({{order.gbDoRemark}})</text>
                </view> 
           
            </view>

            <view  class="p-10 flex-row">
              <image src="../../../../images/search.png" class="icon"></image>
            </view>

          </view>

          <!--  -->

          <block wx:else="">
            <view class="flex flex-row-between  border-bottom p-10 {{order.gbDoBuyStatus < 3 ? 'liziBack' : 'bg-white'}}">
              <view class="flex  font-md">
                <text class="mr-10">{{order.globalOrderIndex || (applyIndex + 1)}}.</text>
                <view class="flex-cloumn" style="width: {{windowWidth - 200}}rpx; ">
                  <view class="flex-row-wrap align-center">
                    <text class="brand" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsBrand !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsBrand.length > 0}}">{{order.gbDistributerGoodsEntity.gbDgGoodsBrand}}</text>
                    <text class="font-bold mr-10">{{order.gbDistributerGoodsEntity.gbDgGoodsName}}</text>

                    <text class="font-sm" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsPlace !== 'null' && order.gbDistributerGoodsEntity.gbDgGoodsPlace.length > 0}}">({{order.gbDistributerGoodsEntity.gbDgGoodsPlace}})</text>

                    <text class="font-sm" wx:if="{{order.gbDistributerGoodsEntity.gbDgGoodsDetail.length > 0 && order.gbDistributerGoodsEntity.gbDgGoodsDetail !==  'null'}}">{{order.gbDistributerGoodsEntity.gbDgGoodsDetail}}</text>

                    <text class="mr-20" wx:if="{{order.gbDoNxGoodsId !== null}}">({{order.gbDoPrintStandard}})</text>
                    <text class="mr-20 font-xs text-secondary" wx:else="">(临时商品)</text>

                    <text class="">订:{{order.gbDoQuantity}}{{order.gbDoStandard}}</text>
                    <text class="text-danger font-sl" wx:if="{{order.gbDoRemark !== null  && order.gbDoRemark.length > 0}}">({{order.gbDoRemark}})</text>
                  </view>


                  <view class="flex flex-row font-sl" wx:if="{{order.gbDoStatus == 2}}">
                    <view class="third-row">
                      <text class="text-secondary">出货:</text>
                      <text class="" wx:if="{{order.gbDoWeight !== null}}">{{order.gbDoWeight}}{{order.gbDoPrintStandard}}</text>
                    </view>

                    <view class="third-row">
                      <text class=" text-secondary">单价:</text>
                      <text class="" wx:if="{{order.gbDoPrice !== null}}">{{order.gbDoPrice}}/{{order.gbDoPrintStandard}}</text>

                    </view>

                    <view class="third-row" wx:if="{{order.gbDoSubtotal !== null || order.gbDoSubtotal == '' }}">
                      <text class="text-secondary">小计:</text>
                      <text class="">{{order.gbDoSubtotal}}元</text>
                    </view>
                  </view>

                </view>
              </view>

              <view class="font-xs pt-20 pb-20" wx:if="{{order.gbDoBuyStatus == 3}}">
                已称重
              </view>
              <view class="font-xs pt-20 pb-20" wx:elif="{{order.gbDoBuyStatus == 4}}">
                <view class="bg-mainColor p-20 radius-20" bind:tap="receiveStock" data-item="{{order}}">收货</view>
              </view>

              <view wx:else="" class="button-container-white" bindtap="toEditApply" data-order="{{order}}" data-subname="" data-id="{{order.gbDistributerGoodsEntity.gbDistributerGoodsId}}" data-name="{{order.gbDistributerGoodsEntity.gbDgGoodsName}}" data-type="goods" data-color="{{order.gbDistributerGoodsEntity.gbDgNxGoodsFatherColor}}" data-goods="{{order.gbDistributerGoodsEntity}}" hover-class="hover">
                <image src="../../../../images/edit.png" class="icon"></image>
              </view>
            </view>
          </block>

        </block>


        <view class="p-20" style="height: 200rpx;" wx:if="{{applyArr.length > 0}}">
          <view class="p-20 text-secondary font-sl" style="text-align:center;">没有数据啦！</view>
        </view>

      </block>

    </scroll-view>
  </view>

  <!-- 遮罩层 -->
  <view class="fab-mask" wx:if="{{showPopup}}" bindtap="closeFab"></view>

  <!-- 蒙层+弹窗 -->

  <!-- 蒙层+弹窗 -->
  <view wx:if="{{showPopup}}" class="popup-mask" catchtap="onMaskTap">
    <view class="popup-box" style="width: {{popupWidth}}rpx; height: {{popupHeight}}rpx; background-color: aqua;" animation="{{popupAnim}}" catchtap="onPopupTap">

      <view class="popup-content">

        <view class="item p-10">
          <button open-type="share" class="flex-row">
            <view class="icon_back flex-column-center">
              <image class="icon" src="../../../../images/icons-.png" mode="aspectFit" />
            </view>
            <view class="flex-column">
              <view class="title flex-row">邀请订货成员</view>
              <view class="desc">发微信好友，订货群成员一起下单</view>
            </view>

            <view>
            </view>
          </button>
        </view>

        <view class="item p-10" bind:tap="toAddOrder" data-type="paste">
          <view class="icon_back flex-column-center">
            <image src="../../../../images/chat_record.png" mode="aspectFill" class="icon" />
          </view>
          <view>
            <view class="title">快速下单</view>
            <view class="desc">支持语音和复制识别</view>
          </view>
        </view>
        <view class="item p-10" bind:tap="toAddOrder" data-type="ai">
          <view class="icon_back flex-column-center">
            <image src="../../../../images/robot-solid.png" mode="aspectFill" class="icon" />
          </view>
          <view>
            <view class="title">智能推荐</view>
            <view class="desc">推荐常用订货</view>
          </view>
        </view>

        <view class="msg-btn-box p-0">
          <view class="msg-btn" bind:tap="toAddOrder" data-type="books">
            <view class="flex-column-center mr-20">
              <image src="../../../../images/goods.png" mode="aspectFill" class="icon" />
            </view>
            <text class="msg-text">配送商品</text>
          </view>
        </view>
      </view>

    </view>
  </view>
  <!-- 圆形按钮同前略 -->


  <view wx:if="{{!showPopup && (searchArr === null || searchArr.length == 0)}}" class="fab" id="fab" bindtap="onFabTap">
    <image src="/images/icons/add.svg" class="fab-plus" style="transform: rotate({{fabRotated ? 45 : 0}}deg); transition: transform 0.3s ease;" />
  </view>

</view>







<myDismodal show="{{show}}" bindconfirm="confirm" bindcancle="cancle" binddelApply="delApply" binddelStandard="delStandard" bindconfirmStandard="confirmStandard" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" hasStock="{{hasStock}}" applySubtotal="{{applySubtotal}}" applyRemark="{{applyRemark}}" editApply="{{editApply}}" expectPrice="{{expectPrice}}" navBarHeight="{{navBarHeight}}" windowWidth="{{windowWidth}}" bindchangeStandard="changeStandard" applyGoodsName="{{applyGoodsName}}" applyGoodsId="{{applyGoodsId}}" item="{{itemDis}}" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" canSave="{{canSave}}" windowWidth="{{windowWidth}}" windowHeight="{{windowHeight}}" />

<delWarnModal wx:if="{{showPopupWarn}}" type="{{popupType}}" warnContent="{{warnContent}}" bind:closeWarn="closeWarn" bind:confirmWarn="confirmWarn" />

<myDismodalCashSingle show="{{showCash}}" bindconfirm="_updateDisOrder" bindcancle="cancle" binddelApply="delApply" bindconfirmStandard="confirmStandard" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" applySubtotal="{{applySubtotal}}" applyRemark="{{applyRemark}}" editApply="{{editApply}}" expectPrice="{{expectPrice}}" bindchangeStandard="changeStandard" applyGoodsName="{{applyGoodsName}}" applyGoodsId="{{applyGoodsId}}" item="{{itemgbDis}}" level="{{priceLevel}}" applyStandardName="{{applyStandardName}}" windowWidth="{{windowWidth}}" windowHeight="{{windowHeight}}" statusBarHeight="{{statusBarHeight}}" />



<view>
  <!-- 背景蒙版 -->
  <view wx:if="{{showPage}}" class="popup-mask" bindtap="hidePopup"></view>

  <!-- 弹出层 -->
  <view wx:if="{{showPage}}" class="popup-overlay" bindtap="hidePopup">
    <!-- 点击遮罩可关闭弹层 -->
    <view class="popup-container font-lg" animation="{{popupAnimation}}" catchtap="noop">
      <view class="flex-row-between p-20" bindtap="hidePopup">
        <view class="flex-column-center font-lg-2 font-bold p-10" style="width: 100%;">
          <text class="">注册用户</text>
        </view>

        <image src="/images/del.png" mode="aspectFill" class="icon p-10" />
      </view>

      <view class="popup-content1 p-30">

        <block wx:if="{{depInfo.gbDepartmentEntities.length > 0}}">

          <view class="flex-row-default">
            <text class="form-label" style="width: 180rpx; line-height: 90rpx;">订货范围</text>

            <view class="flex-column">
              <view class="radio-option1 {{workScope === 'all' ? 'selected' : ''}}" bindtap="selectWorkScope" data-scope="all">
                <text class="font-md">多个部门</text>
                <view class="radio-circle {{workScope === 'all' ? 'checked' : ''}}"></view>
              </view>

              <view class="radio-option1 {{workScope === 'single' ? 'selected' : ''}}" bindtap="selectWorkScope" data-scope="single">
                <text class="font-md">单一部门</text>
                <view class="radio-circle {{workScope === 'single' ? 'checked' : ''}}"></view>
              </view>
            </view>

          </view>

          <view class="flex-row-default" wx:if="{{workScope === 'single'}}">
            <text class="form-label" style="width: 180rpx; line-height: 90rpx;">工作部门</text>
            <view class="form-group" style="width: {{windowWidtth - 300}}rpx;">
              <picker mode="selector" range="{{depInfo.gbDepartmentEntities}}" range-key="gbDepartmentName" bindchange="onDepartmentChange">
                <view class="department-picker1 flex-row" aria-label="选择工作部门">
                  <view style="width: {{windowWidth - 500}}rpx; height: 70rpx;line-height: 70rpx;">{{selDepartmentName || '请选择工作部门'}}</view>
                  <image class="picker-arrow-img" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iOCIgdmlld0JveD0iMCAwIDEyIDgiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTAgMiBsNiA0IDYtNCIgZmlsbD0iIzg4OCI+PC9wYXRoPjwvc3ZnPg==" />
                </view>
              </picker>
            </view>
          </view>
        </block>



        <view class="form-group flex-row">
          <view class="form-label mr-30">用户头像</view>
          <view class="flex-column-center">
            <button class="ava" open-type="chooseAvatar" bind:chooseavatar="onChooseAvatar">
              <image class="avaImg" src="{{avatarUrl}}" mode="aspectFill" />
            </button>
            <text wx:if="{{avatarUrl == '/images/User2.png'}}" class="avatar-tip">请上传头像</text>
          </view>

        </view>

        <view class="form-group mt-10">
          <view class="flex-row">
            <view class="form-label" style="width: 180rpx;">用户名</view>
            <input name="input" type="text" class="inputName" bindinput="getName" placeholder="请输入昵称" maxlength="20" aria-label="输入昵称" />
            <text wx:if="{{nameError}}" class="error-text">{{nameError}}</text>
          </view>

        </view>
      </view>

      <view class="popup-footer" style="padding: 10rpx 40rpx;">
        <view class="save-btn {{!isFormValid ? 'disabled' : 'next'}}" bindtap="toSave" disabled="{{!isFormValid || isLoading}}" loading="{{isLoading}}" aria-label="完成注册">
          注册
        </view>
      </view>
    </view>
  </view>

</view>






<!-- goodsOperation -->
<view class='overlay {{showOperationLinshi ? "show" : ""}}' catchtouchmove='ture' catchtap="hideMaskLinshi">
  <view class="flex-column nnn bg-white font-lg">

    <view class="flex-row p-30 border-bottom" catchtap="toPasteFromGoods" hover-class="hover">
      <image src="/images/search-3.png" class="icon mr-20"></image>
      <text class="">查找商品</text>
    </view>



    <view class="flex-row p-30" catchtap="delApplyPaste" data-id="{{applyItem.gbDepartmentOrdersId}}" hover-class="hover">
      <image src="/images/del.png" class="icon mr-20"></image>
      <text class="">删除订单</text>
    </view>
    <view style="height: 20rpx;"></view>

  </view>

</view>
<!-- ../goodsOperation -->




<!-- 蒙层 -->
<view class="dep-switch-mask" wx:if="{{showDepSwitch}}" bindtap="hideDepSwitch"></view>
<!-- 弹窗 -->
<view class="dep-switch-popup" wx:if="{{showDepSwitch}}" animation="{{depSwitchAnim}}" catchtap="noop">
  <view class="dep-switch-title">
    <image src="/images/icons/record.svg" class="dep-switch-icon" />
    <text>选择下单部门</text>
  </view>
  <scroll-view scroll-y="true" class="dep-switch-list">
    <block wx:for="{{depList}}" wx:key="gbDepartmentId">
      <view class="dep-switch-item {{item.gbDepartmentId == depId ? 'selected' : ''}}" bindtap="onSelectDep" data-item="{{item}}">
        <text class="dep-switch-name">{{item.gbDepartmentName}}</text>
        <image wx:if="{{item.gbDepartmentId == depId}}" src="/images/correct-2.svg" class="dep-switch-check" />
      </view>
    </block>
  </scroll-view>
  <view class="dep-switch-tip">切换部门后，下单将归属所选部门</view>
</view>
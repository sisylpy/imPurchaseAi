<wxs src="../../../../utils/fn.wxs" module="tool" />


<view class="flex flex-column">

  <block wx:if="{{greatId != -1}}">
    <back-navbar-search style="height: {{navBarHeight}}rpx;" titleLarge="{{name}}" title="Âç†ÊÄªÈ¢ùÊØî‰æã{{tool.getProducePercent(value,allCostTotal)}}%" avatar="/images/back-gray.png" button-text="ËÆæÁΩÆ" bindnavbuttontap="toBack" isScrolled="{{isScrolled}}" tabIndex="{{tab1Index}}" bindtabclick="onNavTabClick" pageType="cost">
    </back-navbar-search>
  </block>

  <block wx:else="">
    <back-navbar-search style="height: {{navBarHeight}}rpx;" titleLarge="{{value}}ÂÖÉ" title="Âç†ÊÄªÈ¢ùÊØî‰æã{{tool.getProducePercent(value,allCostTotal)}}%" avatar="/images/back-gray.png" button-text="ËÆæÁΩÆ" bindnavbuttontap="toBack" isScrolled="{{isScrolled}}" tabIndex="{{tab1Index}}" bindtabclick="onNavTabClick" pageType="cost">
    </back-navbar-search>
  </block>


  <!--  search-top -->
  <view class=" flex-row-between pl-20 pr-20 border-bottom bg-white {{isScrolled ? 'hidden' : ''}}">

    <view class="flex-row">
      <view class="p-20" bindtap="toDatePage">
        <image src="../../../../images/calender.png" class="icon"></image>
      </view>
      <view class="flex-column pt-10">
        <view class="font-yuan">{{hanzi}}</view>
        <view class="flex-row" wx:if="{{startDate == stopDate}}">
          <view class=" font-md" wx:if="{{startDate}}"> {{tool.transferDateString(startDate)}}</view>
        </view>
        <view class="flex-row" wx:else>
          <view class="" wx:if="{{startDate}}"> {{tool.transferDateString(startDate)}}</view>
          <text class="plr-10">-</text>
          <view class="" wx:if="{{stopDate}}">{{tool.transferDateString(stopDate)}}</view>
        </view>
      </view>
    </view>

    <!-- <view class="flex-row p-20" bindtap="toFilterType">
      <image src="{{searchDepId !== -1 ? '../../../../images/filter.png' : '../../../../images/filter-3-fill.png'}}" class="icon mr-20"></image>
    </view> -->
  </view>


  <!-- ÈÉ®Èó®Á≠õÈÄâÊòæÁ§∫Âå∫Âüü -->
  <view class="filter-container" wx:if="{{selectedDepartment}}">
    <view class="filter-row">
      <view class="filter-chip">
        <text class="filter-text">ÈÉ®Èó®: {{selectedDepartment.depName}}</text>
        <view class="filter-delete" bindtap="clearDepartmentFilter">
          <image src="/images/del-2.png" mode="aspectFill" class="delete-icon"></image>
        </view>
      </view>
    </view>
  </view>

  <swiper class="swiper-box {{isScrolled ? 'collapsed' : ''}}" duration="300" bindanimationfinish="animationfinish" current="{{tab1Index}}" data-index='{{tab1Index}}' lazy-load="{{false}}">

    <!-- Âà∂‰ΩúÊàêÊú¨ -->
    <swiper-item>
      <scroll-view scroll-y="true" bindscrolltolower="onReachBottom" bindscroll="onScroll">

        <!-- ÊàêÊú¨ÁªüËÆ°Âç°ÁâáÂå∫Âüü -->
        <view class="cost-stats-container">

          <!-- ÂîÆÂá∫ÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 0 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='0' bindtap='onTab1Click' data-type="sales">
            <view class="cost-card-header  mt-10">
              <view class="cost-icon sales-icon">
                <image src="/images/money.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">ÂîÆÂá∫ÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">ÂîÆÂá∫ÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{salesTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{produceCount}}‰∏™</view>
          </view>

          <!-- ÊçüËÄóÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 1 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='1' bindtap='onTab1Click' data-type="loss">
            <view class="cost-card-header  mt-10">
              <view class="cost-icon loss-icon">
                <image src="/images/warning.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">ÊçüËÄóÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">ÊçüËÄóÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{lossTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{lossCount}}‰∏™</view>
          </view>

          <!-- Â∫üÂºÉÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 2 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='2' bindtap='onTab1Click' data-type="waste">
            <view class="cost-card-header mt-10">
              <view class="cost-icon waste-icon">
                <image src="/images/delete.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">Â∫üÂºÉÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">Â∫üÂºÉÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{wasteTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{wasteCount}}‰∏™</view>
          </view>

        </view>

        <!-- ‰ªäÊó•ÊÄªÊîØÂá∫ -->
        <view class="flex-column " wx:if="{{produceArr.length > 0}}">

          <view class="flex-column p-20 bg-white border-bottom" wx:for="{{produceArr}}" wx:for-index="goodsIndex" wx:key="gbDistributerGoodsId">

            <!-- ÂïÜÂìÅ‰ø°ÊÅØÂå∫Âüü -->
            <view class="flex-row-default mb-20">
              <image src="{{url + item.gbDgNxFatherImg}}" mode="aspectFill" class="url_item mr-20" />
              <view class="flex-column" style="flex: 1;">
                <view class="flex-row">
                  <text class="font-sm">Á¨¨{{goodsIndex + 1}}Âêç/ÂÖ±{{totalCount}}‰∏™</text>
                </view>
                <view class="flex-row">
                  <text class="font-bold mr-10">{{item.gbDgGoodsName}}</text>
                  <block wx:if="{{item.gbDgGoodsStandardWeight.length > 0}}">
                    <text class="text-secondary font-xs">({{item.gbDgGoodsStandardWeight}}/{{item.gbDgGoodsStandardname}})</text>
                  </block>
                  <block wx:else>
                    <text class="text-secondary font-xs">({{item.gbDgGoodsStandardname}})</text>
                  </block>
                </view>
              </view>

            </view>

            <!-- Á¨¨‰∫åË°å -->

            <!-- ÈÉ®Èó®‰ø°ÊÅØÂå∫Âüü -->
            <view class="flex-column" wx:for="{{item.wasteDepartmentEntities}}" wx:key="{{dep.gbDepartmentId}}" wx:for-item="dep" wx:for-index="depIndex">

              <view class="flex-column font-xs mb-20" wx:for="{{dep.departmentGoodsDailyEntity.wasteReduceList}}" wx:for-item="reduceDay" wx:for-index="reduceIndex" wx:key="reduceIndex">

                <!-- Êï¥‰ΩìÂç°ÁâáÂÆπÂô® -->
                <view class="unified-card-container {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'unified-card-expanded' : 'unified-card-collapsed'}}">

                  <!-- ÈªòËÆ§ÊòæÁ§∫--‰∏≠Èó¥ÈÉ®ÂàÜ -->
                  <view id="src-{{goodsIndex}}-{{depIndex}}-{{reduceIndex}}" class="stock-row-container" data-index="{{reduceIndex}}" data-item-index="{{goodsIndex}}" data-day-index="{{depIndex}}">
                    <view class="stock-row {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'stock-row-active' : ''}}" bind:tap="showOne" data-index="{{reduceIndex}}" data-item-index="{{goodsIndex}}" data-day-index="{{depIndex}}">

                      <!-- Â∑¶‰æß‰ø°ÊÅØÂå∫Âüü -->
                      <view class="stock-info-left">
                        <view class="stock-department">{{dep.gbDepartmentName}}</view>
                        <view class="stock-date">{{tool.transferDateString(reduceDay.gbDgsrDate)}}</view>
                      </view>

                      <!-- ‰∏≠Èó¥‰ª∑Ê†ºÊï∞ÈáèÂå∫Âüü -->
                      <view class="stock-info-center">
                        <block wx:if="{{reduceDay.gbDgsrType == 1}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrProduceSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrProduceWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type sales-type">ÂîÆÂá∫</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 2}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrWasteSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrWasteWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type waste-type">Â∫üÂºÉ</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 3}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrLossSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrLossWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type loss-type">ÊçüËÄó</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 4}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrReturnSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrReturnWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type return-type">ÈÄÄË¥ß</view>
                        </block>
                      </view>

                      <!-- Âè≥‰æßÁÆ≠Â§¥Âå∫Âüü -->
                      <view class="stock-info-right">
                        <view class="stock-arrow">
                          <image src="/images/arrow-right-3.png" mode="aspectFill" class="arrow-icon {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'expanded' : 'collapsed'}}" />
                        </view>
                      </view>

                    </view>
                  </view>

                  <!-- ÈááË¥≠‰ø°ÊÅØ - ËìùËâ≤‰∏ªÈ¢ò -->
                  <view wx:if="{{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex]}}" class="purchase-info-card expandable-content expanded">

                    <!-- ÂàÜÈöîÁ∫ø -->
                    <view class="section-divider"></view>

                    <!-- Â∫ìÂ≠òËØ¶ÁªÜ‰ø°ÊÅØ - ËìùËâ≤‰∏ªÈ¢ò -->
                    <view class="purchase-info-card">


                      <!-- Â∫ìÂ≠òËØ¶ÁªÜ‰ø°ÊÅØ -->
                      <view class="purchase-detail-section">

                        <!-- Â∫ìÂ≠ò‰ø°ÊÅØË°åÂ∏ÉÂ±Ä -->
                        <view class="stock-info-row">

                          <!-- Â∑¶‰æßÔºöÈÉ®Èó®‰ø°ÊÅØ -->
                          <view class="purchase-info">
                            <text class="font-bold">{{tool.transferDateString(reduceDay.gbDepartmentGoodsStockEntity.gbDgsDate)}}</text>
                            <block wx:if="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser !== null}}">
                              <text class="purchase-type">Ëá™Èáá</text>
                            </block>
                            <block wx:else="">
                              <text class="purchase-type">ËÆ¢Ë¥ß</text>
                            </block>


                          </view>
                          <!-- ÂàÜÈöîÁ∫ø1 -->
                          <view class="comparison-divider"></view>

                          <!-- Â∑¶‰æßÔºöÈÉ®Èó®‰ø°ÊÅØ -->
                          <view class="purchase-info purchase-inbound">
                            <view class="column-label purchase-price">Âçï‰ª∑</view>
                            <view class="column-content">

                              <view class="amount-text">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.gbDpgBuyPrice}}ÂÖÉ/{{item.gbDgGoodsStandardname}}</view>
                              <block wx:if="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser !== null}}">
                                <text class="weight-text purchase-price">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser.gbDuWxNickName}}</text>
                              </block>
                              <block wx:elif="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.nxJrdhSupplierEntity !== null}}">
                                <text class="weight-text">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.nxJrdhSupplierEntity.nxJrdhsSupplierName}}</text>
                              </block>
                            </view>
                          </view>
                          <!-- ÂàÜÈöîÁ∫ø2 -->
                          <view class="comparison-divider"></view>

                          <!-- Âè≥‰æßÔºöÈáëÈ¢ù‰ø°ÊÅØÂØπÊØî -->
                          <view class="stock-comparison-container">
                            <!-- ÂÖ•Â∫ì‰ø°ÊÅØ -->
                            <view class="stock-info-column stock-inbound">
                              <view class="column-label">ÂÖ•Â∫ì</view>
                              <view class="column-content">
                                <text class="amount-text purchase-amount">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsSubtotal}}ÂÖÉ</text>
                                <text class="weight-text">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsWeight}}{{item.gbDgGoodsStandardname}}</text>
                              </view>
                            </view>

                            <!-- ÂàÜÈöîÁ∫ø3 -->
                            <view class="comparison-divider"></view>

                            <!-- Ââ©‰Ωô‰ø°ÊÅØ -->
                            <view class="stock-info-column stock-rest">
                              <view class="column-label">Ââ©‰Ωô</view>
                              <view class="column-content">
                                <text class="amount-text rest-amount">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsRestSubtotal}}ÂÖÉ</text>
                                <text class="weight-text rest-weight">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsRestWeight}}{{item.gbDgGoodsStandardname}}</text>
                              </view>
                            </view>
                          </view>
                        </view>

                      </view>
                    </view>


                  </view>

                </view>
              </view>
            </view>

          </view>

          <view class="flex-column center-content text-secondary" style="height: 100rpx;" wx:if="{{produceArr.length == 0}}">
            <view class="empty_View flex-column-center" style="margin-top: 200rpx;">
              <text class="empty-emoji">üå∂Ô∏è</text>
              <text class="big">Ê≤°ÊúâÊï∞ÊçÆÂï¶!</text>
            </view>
          </view>

          <!-- ÂàÜÈ°µÁä∂ÊÄÅÊòæÁ§∫ -->
          <view class="flex-column-center mt-30 text-secondary" wx:if="{{produceArr.length > 0}}">
            <!-- ÂàÜÈ°µ‰ø°ÊÅØ -->
            <view class="flex-row">
              <text class="pagination-text">ÂÖ±{{totalCount}}Êù°ËÆ∞ÂΩï,Á¨¨{{currentPage}}/{{totalPage}}È°µ</text>
            </view>

            <!-- Âä†ËΩΩ‰∏≠Áä∂ÊÄÅ -->
            <view class="loading-more" wx:if="{{isLoading}}">
              <text class="loading-text">Âä†ËΩΩ‰∏≠...</text>
            </view>

            <!-- Âä†ËΩΩÊõ¥Â§öÊèêÁ§∫ -->
            <view class="load-more-tip" wx:elif="{{currentPage < totalPage}}">
              <text class="tip-text">‰∏äÊãâÂä†ËΩΩÊõ¥Â§ö</text>
            </view>

            <!-- Â∑≤Âä†ËΩΩÂÖ®ÈÉ® -->
            <view class="load-complete" wx:elif="{{currentPage >= totalPage && totalPage > 0}}">
              <text class="complete-text">Â∑≤Âä†ËΩΩÂÖ®ÈÉ®Êï∞ÊçÆ</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </swiper-item>

    <!-- Âà∂‰ΩúÊàêÊú¨ -->
    <swiper-item>
      <scroll-view scroll-y="true" bindscrolltolower="onReachBottom" bindscroll="onScroll">

        <!-- ÊàêÊú¨ÁªüËÆ°Âç°ÁâáÂå∫Âüü -->
        <view class="cost-stats-container">

          <!-- ÂîÆÂá∫ÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 0 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='0' bindtap='onTab1Click' data-type="sales">
            <view class="cost-card-header  mt-10">
              <view class="cost-icon sales-icon">
                <image src="/images/money.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">ÂîÆÂá∫ÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">ÂîÆÂá∫ÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{salesTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{produceCount}}‰∏™</view>
          </view>

          <!-- ÊçüËÄóÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 1 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='1' bindtap='onTab1Click' data-type="loss">
            <view class="cost-card-header  mt-10">
              <view class="cost-icon loss-icon">
                <image src="/images/warning.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">ÊçüËÄóÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">ÊçüËÄóÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{lossTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{lossCount}}‰∏™</view>
          </view>

          <!-- Â∫üÂºÉÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 2 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='2' bindtap='onTab1Click' data-type="waste">
            <view class="cost-card-header mt-10">
              <view class="cost-icon waste-icon">
                <image src="/images/delete.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">Â∫üÂºÉÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">Â∫üÂºÉÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{wasteTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{wasteCount}}‰∏™</view>
          </view>

        </view>

        <!-- ‰ªäÊó•ÊÄªÊîØÂá∫ -->
        <view class="flex-column " wx:if="{{produceArr.length > 0}}">

          <view class="flex-column p-20 bg-white border-bottom" wx:for="{{produceArr}}" wx:for-index="goodsIndex" wx:key="gbDistributerGoodsId">

            <!-- ÂïÜÂìÅ‰ø°ÊÅØÂå∫Âüü -->
            <view class="flex-row-default mb-20">
              <image src="{{url + item.gbDgNxFatherImg}}" mode="aspectFill" class="url_item mr-20" />
              <view class="flex-column" style="flex: 1;">
                <view class="flex-row">
                  <text class="font-sm">Á¨¨{{goodsIndex + 1}}Âêç/ÂÖ±{{totalCount}}‰∏™</text>
                </view>
                <view class="flex-row">
                  <text class="font-bold mr-10">{{item.gbDgGoodsName}}</text>
                  <block wx:if="{{item.gbDgGoodsStandardWeight.length > 0}}">
                    <text class="text-secondary font-xs">({{item.gbDgGoodsStandardWeight}}/{{item.gbDgGoodsStandardname}})</text>
                  </block>
                  <block wx:else>
                    <text class="text-secondary font-xs">({{item.gbDgGoodsStandardname}})</text>
                  </block>
                </view>
              </view>

            </view>

            <!-- Á¨¨‰∫åË°å -->

            <!-- ÈÉ®Èó®‰ø°ÊÅØÂå∫Âüü -->
            <view class="flex-column" wx:for="{{item.wasteDepartmentEntities}}" wx:key="{{dep.gbDepartmentId}}" wx:for-item="dep" wx:for-index="depIndex">

              <view class="flex-column font-xs mb-20" wx:for="{{dep.departmentGoodsDailyEntity.wasteReduceList}}" wx:for-item="reduceDay" wx:for-index="reduceIndex" wx:key="reduceIndex">

                <!-- Êï¥‰ΩìÂç°ÁâáÂÆπÂô® -->
                <view class="unified-card-container {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'unified-card-expanded' : 'unified-card-collapsed'}}">

                  <!-- ÈªòËÆ§ÊòæÁ§∫--‰∏≠Èó¥ÈÉ®ÂàÜ -->
                  <view id="src-{{goodsIndex}}-{{depIndex}}-{{reduceIndex}}" class="stock-row-container" data-index="{{reduceIndex}}" data-item-index="{{goodsIndex}}" data-day-index="{{depIndex}}">
                    <view class="stock-row {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'stock-row-active' : ''}}" bind:tap="showOne" data-index="{{reduceIndex}}" data-item-index="{{goodsIndex}}" data-day-index="{{depIndex}}">

                      <!-- Â∑¶‰æß‰ø°ÊÅØÂå∫Âüü -->
                      <view class="stock-info-left">
                        <view class="stock-department">{{dep.gbDepartmentName}}</view>
                        <view class="stock-date">{{tool.transferDateString(reduceDay.gbDgsrDate)}}</view>
                      </view>

                      <!-- ‰∏≠Èó¥‰ª∑Ê†ºÊï∞ÈáèÂå∫Âüü -->
                      <view class="stock-info-center">
                        <block wx:if="{{reduceDay.gbDgsrType == 1}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrProduceSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrProduceWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type sales-type">ÂîÆÂá∫</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 2}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrWasteSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrWasteWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type waste-type">Â∫üÂºÉ</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 3}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrLossSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrLossWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type loss-type">ÊçüËÄó</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 4}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrReturnSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrReturnWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type return-type">ÈÄÄË¥ß</view>
                        </block>
                      </view>

                      <!-- Âè≥‰æßÁÆ≠Â§¥Âå∫Âüü -->
                      <view class="stock-info-right">
                        <view class="stock-arrow">
                          <image src="/images/arrow-right-3.png" mode="aspectFill" class="arrow-icon {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'expanded' : 'collapsed'}}" />
                        </view>
                      </view>

                    </view>
                  </view>

                  <!-- ÈááË¥≠‰ø°ÊÅØ - ËìùËâ≤‰∏ªÈ¢ò -->
                  <view wx:if="{{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex]}}" class="purchase-info-card expandable-content expanded">

                    <!-- ÂàÜÈöîÁ∫ø -->
                    <view class="section-divider"></view>

                    <!-- Â∫ìÂ≠òËØ¶ÁªÜ‰ø°ÊÅØ - ËìùËâ≤‰∏ªÈ¢ò -->
                    <view class="purchase-info-card">


                      <!-- Â∫ìÂ≠òËØ¶ÁªÜ‰ø°ÊÅØ -->
                      <view class="purchase-detail-section">

                        <!-- Â∫ìÂ≠ò‰ø°ÊÅØË°åÂ∏ÉÂ±Ä -->
                        <view class="stock-info-row">

                          <!-- Â∑¶‰æßÔºöÈÉ®Èó®‰ø°ÊÅØ -->
                          <view class="purchase-info">
                            <text class="font-bold">{{tool.transferDateString(reduceDay.gbDepartmentGoodsStockEntity.gbDgsDate)}}</text>
                            <block wx:if="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser !== null}}">
                              <text class="purchase-type">Ëá™Èáá</text>
                            </block>
                            <block wx:else="">
                              <text class="purchase-type">ËÆ¢Ë¥ß</text>
                            </block>


                          </view>
                          <!-- ÂàÜÈöîÁ∫ø1 -->
                          <view class="comparison-divider"></view>

                          <!-- Â∑¶‰æßÔºöÈÉ®Èó®‰ø°ÊÅØ -->
                          <view class="purchase-info purchase-inbound">
                            <view class="column-label purchase-price">Âçï‰ª∑</view>
                            <view class="column-content">

                              <view class="amount-text">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.gbDpgBuyPrice}}ÂÖÉ/{{item.gbDgGoodsStandardname}}</view>
                              <block wx:if="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser !== null}}">
                                <text class="weight-text purchase-price">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser.gbDuWxNickName}}</text>
                              </block>
                              <block wx:elif="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.nxJrdhSupplierEntity !== null}}">
                                <text class="weight-text">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.nxJrdhSupplierEntity.nxJrdhsSupplierName}}</text>
                              </block>
                            </view>
                          </view>
                          <!-- ÂàÜÈöîÁ∫ø2 -->
                          <view class="comparison-divider"></view>

                          <!-- Âè≥‰æßÔºöÈáëÈ¢ù‰ø°ÊÅØÂØπÊØî -->
                          <view class="stock-comparison-container">
                            <!-- ÂÖ•Â∫ì‰ø°ÊÅØ -->
                            <view class="stock-info-column stock-inbound">
                              <view class="column-label">ÂÖ•Â∫ì</view>
                              <view class="column-content">
                                <text class="amount-text purchase-amount">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsSubtotal}}ÂÖÉ</text>
                                <text class="weight-text">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsWeight}}{{item.gbDgGoodsStandardname}}</text>
                              </view>
                            </view>

                            <!-- ÂàÜÈöîÁ∫ø3 -->
                            <view class="comparison-divider"></view>

                            <!-- Ââ©‰Ωô‰ø°ÊÅØ -->
                            <view class="stock-info-column stock-rest">
                              <view class="column-label">Ââ©‰Ωô</view>
                              <view class="column-content">
                                <text class="amount-text rest-amount">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsRestSubtotal}}ÂÖÉ</text>
                                <text class="weight-text rest-weight">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsRestWeight}}{{item.gbDgGoodsStandardname}}</text>
                              </view>
                            </view>
                          </view>
                        </view>

                      </view>
                    </view>


                  </view>

                </view>
              </view>
            </view>

          </view>

          <view class="flex-column center-content text-secondary" style="height: 100rpx;" wx:if="{{produceArr.length == 0}}">
            <view class="empty_View flex-column-center" style="margin-top: 200rpx;">
              <text class="empty-emoji">üå∂Ô∏è</text>
              <text class="big">Ê≤°ÊúâÊï∞ÊçÆÂï¶!</text>
            </view>
          </view>

          <!-- ÂàÜÈ°µÁä∂ÊÄÅÊòæÁ§∫ -->
          <view class="flex-column-center mt-30 text-secondary" wx:if="{{produceArr.length > 0}}">
            <!-- ÂàÜÈ°µ‰ø°ÊÅØ -->
            <view class="flex-row">
              <text class="pagination-text">ÂÖ±{{totalCount}}Êù°ËÆ∞ÂΩï,Á¨¨{{currentPage}}/{{totalPage}}È°µ</text>
            </view>

            <!-- Âä†ËΩΩ‰∏≠Áä∂ÊÄÅ -->
            <view class="loading-more" wx:if="{{isLoading}}">
              <text class="loading-text">Âä†ËΩΩ‰∏≠...</text>
            </view>

            <!-- Âä†ËΩΩÊõ¥Â§öÊèêÁ§∫ -->
            <view class="load-more-tip" wx:elif="{{currentPage < totalPage}}">
              <text class="tip-text">‰∏äÊãâÂä†ËΩΩÊõ¥Â§ö</text>
            </view>

            <!-- Â∑≤Âä†ËΩΩÂÖ®ÈÉ® -->
            <view class="load-complete" wx:elif="{{currentPage >= totalPage && totalPage > 0}}">
              <text class="complete-text">Â∑≤Âä†ËΩΩÂÖ®ÈÉ®Êï∞ÊçÆ</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </swiper-item>


    <!-- Âà∂‰ΩúÊàêÊú¨ -->
    <swiper-item>
      <scroll-view scroll-y="true" bindscrolltolower="onReachBottom" bindscroll="onScroll">

        <!-- ÊàêÊú¨ÁªüËÆ°Âç°ÁâáÂå∫Âüü -->
        <view class="cost-stats-container">

          <!-- ÂîÆÂá∫ÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 0 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='0' bindtap='onTab1Click' data-type="sales">
            <view class="cost-card-header  mt-10">
              <view class="cost-icon sales-icon">
                <image src="/images/money.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">ÂîÆÂá∫ÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">ÂîÆÂá∫ÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{salesTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{produceCount}}‰∏™</view>
          </view>

          <!-- ÊçüËÄóÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 1 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='1' bindtap='onTab1Click' data-type="loss">
            <view class="cost-card-header  mt-10">
              <view class="cost-icon loss-icon">
                <image src="/images/warning.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">ÊçüËÄóÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">ÊçüËÄóÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{lossTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{lossCount}}‰∏™</view>
          </view>

          <!-- Â∫üÂºÉÊàêÊú¨Âç°Áâá -->
          <view class="cost-card {{tab1Index == 2 ? 'cost-card-active' : ''}} {{isScrolled ? 'collapsed' : ''}}" data-index='2' bindtap='onTab1Click' data-type="waste">
            <view class="cost-card-header mt-10">
              <view class="cost-icon waste-icon">
                <image src="/images/delete.png" class="icon-image"></image>
              </view>
              <view class="cost-title" wx:if="{{!isScrolled}}">Â∫üÂºÉÊàêÊú¨</view>
              <view class="cost-title-collapsed" wx:if="{{isScrolled}}">Â∫üÂºÉÊàêÊú¨</view>
            </view>
            <view class="cost-amount" wx:if="{{!isScrolled}}">{{wasteTotal}}ÂÖÉ</view>

            <view class="cost-total" wx:if="{{!isScrolled}}">ÂïÜÂìÅ{{wasteCount}}‰∏™</view>
          </view>

        </view>

        <!-- ‰ªäÊó•ÊÄªÊîØÂá∫ -->
        <view class="flex-column " wx:if="{{produceArr.length > 0}}">

          <view class="flex-column p-20 bg-white border-bottom" wx:for="{{produceArr}}" wx:for-index="goodsIndex" wx:key="gbDistributerGoodsId">

            <!-- ÂïÜÂìÅ‰ø°ÊÅØÂå∫Âüü -->
            <view class="flex-row-default mb-20">
              <image src="{{url + item.gbDgNxFatherImg}}" mode="aspectFill" class="url_item mr-20" />
              <view class="flex-column" style="flex: 1;">
                <view class="flex-row">
                  <text class="font-sm">Á¨¨{{goodsIndex + 1}}Âêç/ÂÖ±{{totalCount}}‰∏™</text>
                </view>
                <view class="flex-row">
                  <text class="font-bold mr-10">{{item.gbDgGoodsName}}</text>
                  <block wx:if="{{item.gbDgGoodsStandardWeight.length > 0}}">
                    <text class="text-secondary font-xs">({{item.gbDgGoodsStandardWeight}}/{{item.gbDgGoodsStandardname}})</text>
                  </block>
                  <block wx:else>
                    <text class="text-secondary font-xs">({{item.gbDgGoodsStandardname}})</text>
                  </block>
                </view>
              </view>

            </view>

            <!-- Á¨¨‰∫åË°å -->

            <!-- ÈÉ®Èó®‰ø°ÊÅØÂå∫Âüü -->
            <view class="flex-column" wx:for="{{item.wasteDepartmentEntities}}" wx:key="{{dep.gbDepartmentId}}" wx:for-item="dep" wx:for-index="depIndex">

              <view class="flex-column font-xs mb-20" wx:for="{{dep.departmentGoodsDailyEntity.wasteReduceList}}" wx:for-item="reduceDay" wx:for-index="reduceIndex" wx:key="reduceIndex">

                <!-- Êï¥‰ΩìÂç°ÁâáÂÆπÂô® -->
                <view class="unified-card-container {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'unified-card-expanded' : 'unified-card-collapsed'}}">

                  <!-- ÈªòËÆ§ÊòæÁ§∫--‰∏≠Èó¥ÈÉ®ÂàÜ -->
                  <view id="src-{{goodsIndex}}-{{depIndex}}-{{reduceIndex}}" class="stock-row-container" data-index="{{reduceIndex}}" data-item-index="{{goodsIndex}}" data-day-index="{{depIndex}}">
                    <view class="stock-row {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'stock-row-active' : ''}}" bind:tap="showOne" data-index="{{reduceIndex}}" data-item-index="{{goodsIndex}}" data-day-index="{{depIndex}}">

                      <!-- Â∑¶‰æß‰ø°ÊÅØÂå∫Âüü -->
                      <view class="stock-info-left">
                        <view class="stock-department">{{dep.gbDepartmentName}}</view>
                        <view class="stock-date">{{tool.transferDateString(reduceDay.gbDgsrDate)}}</view>
                      </view>

                      <!-- ‰∏≠Èó¥‰ª∑Ê†ºÊï∞ÈáèÂå∫Âüü -->
                      <view class="stock-info-center">
                        <block wx:if="{{reduceDay.gbDgsrType == 1}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrProduceSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrProduceWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type sales-type">ÂîÆÂá∫</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 2}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrWasteSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrWasteWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type waste-type">Â∫üÂºÉ</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 3}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrLossSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrLossWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type loss-type">ÊçüËÄó</view>
                        </block>
                        <block wx:if="{{reduceDay.gbDgsrType == 4}}">
                          <view class="stock-amount">{{reduceDay.gbDgsrReturnSubtotal}}ÂÖÉ</view>
                          <view class="stock-quantity">{{reduceDay.gbDgsrReturnWeight}}{{item.gbDgGoodsStandardname}}</view>
                          <view class="stock-type return-type">ÈÄÄË¥ß</view>
                        </block>
                      </view>

                      <!-- Âè≥‰æßÁÆ≠Â§¥Âå∫Âüü -->
                      <view class="stock-info-right">
                        <view class="stock-arrow">
                          <image src="/images/arrow-right-3.png" mode="aspectFill" class="arrow-icon {{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex] ? 'expanded' : 'collapsed'}}" />
                        </view>
                      </view>

                    </view>
                  </view>

                  <!-- ÈááË¥≠‰ø°ÊÅØ - ËìùËâ≤‰∏ªÈ¢ò -->
                  <view wx:if="{{expandedRows[goodsIndex + '_' + depIndex + '_' + reduceIndex]}}" class="purchase-info-card expandable-content expanded">

                    <!-- ÂàÜÈöîÁ∫ø -->
                    <view class="section-divider"></view>

                    <!-- Â∫ìÂ≠òËØ¶ÁªÜ‰ø°ÊÅØ - ËìùËâ≤‰∏ªÈ¢ò -->
                    <view class="purchase-info-card">


                      <!-- Â∫ìÂ≠òËØ¶ÁªÜ‰ø°ÊÅØ -->
                      <view class="purchase-detail-section">

                        <!-- Â∫ìÂ≠ò‰ø°ÊÅØË°åÂ∏ÉÂ±Ä -->
                        <view class="stock-info-row">

                          <!-- Â∑¶‰æßÔºöÈÉ®Èó®‰ø°ÊÅØ -->
                          <view class="purchase-info">
                            <text class="font-bold">{{tool.transferDateString(reduceDay.gbDepartmentGoodsStockEntity.gbDgsDate)}}</text>
                            <block wx:if="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser !== null}}">
                              <text class="purchase-type">Ëá™Èáá</text>
                            </block>
                            <block wx:else="">
                              <text class="purchase-type">ËÆ¢Ë¥ß</text>
                            </block>


                          </view>
                          <!-- ÂàÜÈöîÁ∫ø1 -->
                          <view class="comparison-divider"></view>

                          <!-- Â∑¶‰æßÔºöÈÉ®Èó®‰ø°ÊÅØ -->
                          <view class="purchase-info purchase-inbound">
                            <view class="column-label purchase-price">Âçï‰ª∑</view>
                            <view class="column-content">

                              <view class="amount-text">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.gbDpgBuyPrice}}ÂÖÉ/{{item.gbDgGoodsStandardname}}</view>
                              <block wx:if="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser !== null}}">
                                <text class="weight-text purchase-price">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.purchaseDepartmentUser.gbDuWxNickName}}</text>
                              </block>
                              <block wx:elif="{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.nxJrdhSupplierEntity !== null}}">
                                <text class="weight-text">{{reduceDay.gbDepartmentGoodsStockEntity.purchaseGoodsEntity.nxJrdhSupplierEntity.nxJrdhsSupplierName}}</text>
                              </block>
                            </view>
                          </view>
                          <!-- ÂàÜÈöîÁ∫ø2 -->
                          <view class="comparison-divider"></view>

                          <!-- Âè≥‰æßÔºöÈáëÈ¢ù‰ø°ÊÅØÂØπÊØî -->
                          <view class="stock-comparison-container">
                            <!-- ÂÖ•Â∫ì‰ø°ÊÅØ -->
                            <view class="stock-info-column stock-inbound">
                              <view class="column-label">ÂÖ•Â∫ì</view>
                              <view class="column-content">
                                <text class="amount-text purchase-amount">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsSubtotal}}ÂÖÉ</text>
                                <text class="weight-text">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsWeight}}{{item.gbDgGoodsStandardname}}</text>
                              </view>
                            </view>

                            <!-- ÂàÜÈöîÁ∫ø3 -->
                            <view class="comparison-divider"></view>

                            <!-- Ââ©‰Ωô‰ø°ÊÅØ -->
                            <view class="stock-info-column stock-rest">
                              <view class="column-label">Ââ©‰Ωô</view>
                              <view class="column-content">
                                <text class="amount-text rest-amount">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsRestSubtotal}}ÂÖÉ</text>
                                <text class="weight-text rest-weight">{{reduceDay.gbDepartmentGoodsStockEntity.gbDgsRestWeight}}{{item.gbDgGoodsStandardname}}</text>
                              </view>
                            </view>
                          </view>
                        </view>

                      </view>
                    </view>


                  </view>

                </view>
              </view>
            </view>

          </view>

          <view class="flex-column center-content text-secondary" style="height: 100rpx;" wx:if="{{produceArr.length == 0}}">
            <view class="empty_View flex-column-center" style="margin-top: 200rpx;">
              <text class="empty-emoji">üå∂Ô∏è</text>
              <text class="big">Ê≤°ÊúâÊï∞ÊçÆÂï¶!</text>
            </view>
          </view>

          <!-- ÂàÜÈ°µÁä∂ÊÄÅÊòæÁ§∫ -->
          <view class="flex-column-center mt-30 text-secondary" wx:if="{{produceArr.length > 0}}">
            <!-- ÂàÜÈ°µ‰ø°ÊÅØ -->
            <view class="flex-row">
              <text class="pagination-text">ÂÖ±{{totalCount}}Êù°ËÆ∞ÂΩï,Á¨¨{{currentPage}}/{{totalPage}}È°µ</text>
            </view>

            <!-- Âä†ËΩΩ‰∏≠Áä∂ÊÄÅ -->
            <view class="loading-more" wx:if="{{isLoading}}">
              <text class="loading-text">Âä†ËΩΩ‰∏≠...</text>
            </view>

            <!-- Âä†ËΩΩÊõ¥Â§öÊèêÁ§∫ -->
            <view class="load-more-tip" wx:elif="{{currentPage < totalPage}}">
              <text class="tip-text">‰∏äÊãâÂä†ËΩΩÊõ¥Â§ö</text>
            </view>

            <!-- Â∑≤Âä†ËΩΩÂÖ®ÈÉ® -->
            <view class="load-complete" wx:elif="{{currentPage >= totalPage && totalPage > 0}}">
              <text class="complete-text">Â∑≤Âä†ËΩΩÂÖ®ÈÉ®Êï∞ÊçÆ</text>
            </view>
          </view>
        </view>
      </scroll-view>
    </swiper-item>


  </swiper>



</view>
<wxs src="../../../../utils/fn.wxs" module="tool" />


<view class="flex flex-column">


  <back-navbar title="日看板" style="height: {{navBarHeight}}rpx;" avatar="/images/back-gray.png" button-text="设置" bindnavbuttontap="toBack"></back-navbar>

  <!--  top -->
  <view class=" flex-row-between pl-20 pr-20 border-bottom bg-white">
    <view class="flex-row">
      <view class="p-20" bindtap="toDatePage">
        <image src="../../../../images/calender.png" class="icon"></image>
      </view>
      <view class="flex-column pt-10">
        <view class="font-yuan">{{hanzi}}</view>
        <view class="flex-row" wx:if="{{startDate == stopDate}}">
          <view class=" small" wx:if="{{startDate}}"> {{tool.transferDateString(startDate)}}</view>
        </view>
        <view class="flex-row" wx:else>
          <view class="" wx:if="{{startDate}}"> {{tool.transferDateString(startDate)}}</view>
          <text class="plr-10">-</text>
          <view class="" wx:if="{{stopDate}}">{{tool.transferDateString(stopDate)}}</view>
        </view>
      </view>
    </view>

    <!-- <view class="flex-row p-20" bindtap="toFilterType">
      <image src="{{searchDepId !== -1 ? '../../../../images/filter.png' : '../../../../images/filter-3-fill.png'}}" class="icon mr-20"></image>
    </view> -->
  </view>


  <!-- 供货商和采购员选择显示 -->
  <view class="filter-container" wx:if="{{(selectedSupplierName && selectedSupplierName.length > 0) || (selectedPurUserName && selectedPurUserName.length > 0)}}">
    <view class="filter-row">
      <!-- 供货商选择显示 -->
      <view class="filter-chip" wx:if="{{selectedSupplierName && selectedSupplierName.length > 0}}">
        <text class="filter-text">供货商: {{selectedSupplierName}}</text>
        <view class="filter-delete" bindtap="delSearch">
          <image src="/images/del-2.png" mode="aspectFill" class="delete-icon"></image>
        </view>
      </view>

      <!-- 采购员选择显示 -->
      <view class="filter-chip" wx:if="{{selectedPurUserName && selectedPurUserName.length > 0}}">
        <text class="filter-text">采购员: {{selectedPurUserName}}</text>
        <view class="filter-delete" bindtap="delSearch">
          <image src="/images/del-2.png" mode="aspectFill" class="delete-icon"></image>
        </view>
      </view>
    </view>
  </view>



  <view class="flex-column">
    <view class="flex-column  " wx:if="{{arr.length > 0}}">
      <view class="flex-column p-20 mb-20 mt-30  bg-white" style=" padding-bottom: 40rpx;">
        <view class="flex-row-between p-20">
          <view class="flex-column">
            <view>
              <view class="font-xs text-secondary">采购总额</view>
              <view class="font-lg font-bold" style="color: #007aff;">{{allTotal}}元</view>
            </view>
            <view class="font-sm">
              <view class="font-xs text-secondary">平均</view>
              <view class="font-lg font-bold" style="color: #007aff;">{{purchasePerDay}}元/天</view>
            </view>
          </view>

          <view class="flex-column">
            <view class="flex-column">
              <view class="font-xs text-secondary">成本金额</view>
              <view class="font-lg font-bold" style="color: #05c0a7;">{{costTotal}}元</view>
              <view class="font-xs font-bold text-secondary" >本期:{{costTotalPer}}元</view>
            </view>
            <view class="flex-column font-sm">
              <view class="font-xs text-secondary">平均</view>
              <view class="font-lg font-bold" style="color: #05c0a7;">{{costPerDay}}元/天</view>
            </view>
          </view>

        </view>

        <view class="flex-column" style="height: 400rpx; margin-top: 20rpx;">
          <ec-canvas id="dailyChart" canvas-id="dailyChart" ec="{{ ecDaily }}" style="width: 100%; height: 100%;"></ec-canvas>
        </view>

      </view>


      <view class="bg-white">
        <view class="flex-column border-bottom p-20" wx:for="{{arr}}" wx:key="day" style="width: {{windowWidth - 40}}rpx; background-color: #f5f5f5;">

          <!-- 日期显示在顶部 - 按照图片样式 -->
          <view class="flex-row-center mb-20">
            <text class="font-md font-bold" style="color: #333;">{{tool.getMonthDay(item.day)}} {{tool.getWeekDay(item.day)}}</text>
          </view>

          <!-- 主要内容：左右两列 -->
          <view class="flex-row-between" style="flex: 1; gap: 20rpx;" wx:if="{{item.purTotal > 0 || item.costTotal  > 0}}">

            <!-- 左侧：采购列 -->
            <view class="flex-column" style="flex: 1;">
              <!-- 采购卡片 -->
              <view class="flex-column p-20" style="background-color: white; border-radius: 8rpx; box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.1);" bindtap="toPurGoodsFenxi" data-item="{{item}}"  hover-class="hover">
               
                <!-- 图标 + 标题 -->
                <view class="flex-row align-center mb-15">
                  <image src="../../../../images/gouwuche.png" style="width: 32rpx; height: 32rpx; margin-right: 8rpx;"></image>
                  <text class="font-sm font-bold" >采购</text>
                </view>

                <!-- 采购数据 -->
                <view class="flex-column">
                  <view class="flex-row-between mb-8">
                    <text class="font-xs text-secondary">自采:</text>
                    <text class="font-xs">{{item.zicai}}元</text>
                  </view>
                  <view class="flex-row-between mb-8">
                    <text class="font-xs text-secondary">订货:</text>
                    <text class="font-xs">{{item.dinghuo}}元</text>
                  </view>


                </view>

                <!-- 图标 + 标题 -->
                <view class="flex-row align-center mb-15">
                  <image src="../../../../images/kucun.png" style="width: 32rpx; height: 32rpx; margin-right: 8rpx;"></image>
                  <text class="font-sm font-bold" >库存</text>
                </view>

                <!-- 库存数据 -->
                <view class="flex-column">
                  <view class="flex-row-between mb-8">
                    <text class="font-xs text-secondary">库存:</text>
                    <text class="font-xs">{{item.stockRest}}元</text>
                  </view>


                </view>

              </view>
            </view>

            <!-- 右侧：支出列 -->
            <view class="flex-column" style="flex: 1;">
              <!-- 支出卡片 -->
              <view class="flex-column p-20" style="background-color: white; border-radius: 8rpx; box-shadow: 0 2rpx 8rpx rgba(0,0,0,0.1);" bind:tap="toFenxiDate" data-index="{{index}}" hover-class="hover">
                <!-- 图标 + 标题 -->
                <view class="flex-row align-center mb-15">
                  <image src="../../../../images/qiandaizi.png" style="width: 32rpx; height: 32rpx; margin-right: 8rpx;"></image>
                  <text class="font-sm font-bold" >支出</text>
                </view>

                <!-- 支出数据 -->
                <view class="flex-column">
                  <view class="flex-row-between mb-8">
                    <text class="font-xs text-secondary">销售:</text>
                    <text class="font-xs" >{{item.produceSubtotal}}元</text>
                  </view>
                  <view class="flex-row-between mb-8">
                    <text class="font-xs text-secondary">损耗:</text>
                    <text class="font-xs">{{item.lossTotal}}元</text>
                  </view>
                  <view class="flex-row-between mb-8">
                    <text class="font-xs text-secondary">废弃:</text>
                    <text class="font-xs">{{item.wasteTotal}}元</text>
                  </view>
                  <view class="flex-row-between">
                    <text class="font-sm font-bold">合计:</text>
                    <text class="font-sm font-bold" >{{item.costTotal}}元</text>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </view>
      </view>

      <view class="text-secondary font-xs flex-column center-content" style="height: 200rpx;">没有数据了！</view>

    </view>



  <view class="" wx:if="{{arr.length == 0}}" style="height: {{windowHeight - 360}}rpx;">

<view class="center-content flex-column" style="padding-top: 200rpx;">
  <image class="empty_image" src="/images/cart-Empty.png"></image>
  <text class="big">无数据</text>
</view>

</view>
<!-- ./empty -->




  </view>

</view>
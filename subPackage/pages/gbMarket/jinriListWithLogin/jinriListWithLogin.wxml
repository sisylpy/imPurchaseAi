<wxs src="../../../../utils/fn.wxs" module="tool" />


<view class="containerIndex">

  <!-- é¡¶éƒ¨èœå• -->
  <view class="flex-column">
    <view class="top_img_fixed flex-row" style="width: 100%; height: 110rpx; line-height: 110rpx; padding-top: {{statusBarHeight}}rpx;">
      <view class="p-20" bindtap="toggleMenu">
        <image src="/images/list.png" mode="aspectFill" class="icon-lg" />
      </view>
    </view>
    <image src="../../../../images/top.png" style="width: 100%; height: {{statusBarHeight + 110}}rpx;"></image>
  </view>

  <!-- ä¾§è¾¹èœå• -->
  <view class="side-menu" animation="{{menuAnimationData}}" style="width: {{windowWidth * 0.8}}rpx; left: -{{sideMenuWidth * rpxR}}rpx; background-color: #05668d; color: #fff; " bindtouchstart="sideMenuTouchStart" bindtouchmove="sideMenuTouchMove" bindtouchend="sideMenuTouchEnd">

    <view class="p-30" style="margin-top: {{statusBarHeight + 10}}rpx;" bind:tap="toEditUserGb">
      <image src="{{url + jrdhUserInfo.nxJrdhWxAvartraUrl}}" mode="aspectFill" class="url_item" />
    </view>
    <view class="flex-column">
      <view class="text-white p-20">å®¢æˆ·åˆ—è¡¨</view>
      <scroll-view scroll-y="true" style=" height: {{windowHeight  - statusBarHeight - 340}}rpx;">
        <view wx:for="{{customerArr}}" class="flex-column" wx:for-item="item" bind:tap="supplierSelGb" wx:for-index="index" data-index="{{index}}" data-type="gb">
          <view class="flex-row-between border-bottom  p-20 {{ index == showIndex ? 'selBack' : ''}}">
            <view class="flex-column">
              <view class="flex-row p-20">
                <text class="big">{{item.gbDistributerEntity.gbDistributerName}}</text>
              </view>

            </view>
            <image wx:if="{{index == showIndex}}" src="/images/correct.png" mode="aspectFill" class="icon" />

          </view>
        </view>
      </scroll-view>


    </view>

  </view>

  <!-- ä¸»å†…å®¹ -->
  <scroll-view scroll-y="true" class="main" style="margin-top: {{statusBarHeight + 100}}rpx; height: {{windowHeight - statusBarHeight - 100}}rpx;" animation="{{mainAnimationData}}" refresher-enabled="{{true}}" refresher-triggered="{{refresherTriggered}}" bindrefresherrefresh="onRefresh" refresher-threshold="{{100}}" refresher-default-style="{{false}}" refresher-background="#f7f7f7">

    <!-- è‡ªå®šä¹‰ä¸‹æ‹‰åˆ·æ–°åŠ¨ç”» -->
    <view slot="refresher" class="custom-refresher">
      <view class="refresher-content">
        <image src="/images/refresh.png" class="refresh-icon {{refresherTriggered ? 'rotating' : ''}}" />
        <text class="refresh-text">{{refresherTriggered ? 'æ­£åœ¨åˆ·æ–°...' : 'ä¸‹æ‹‰åˆ·æ–°'}}</text>
      </view>
    </view>

    <!-- é¡µé¢å†…å®¹ -->
    <view class="content">
      <!-- åœ¨è¿™é‡Œæ·»åŠ æ‚¨çš„ä¸»è¦å†…å®¹ -->

      <view class="flex-column">

        <view class="flex-row  big_full_padding" wx:if="{{gbDisInfo !== null}}">

          <image src="{{url + supplierInfo.gbPurUserEntity.gbDuWxAvartraUrl}}" mode="aspectFill" class="" style="border-radius: 50%;  width: {{windowWidth /8}}rpx; height: {{windowWidth / 8}}rpx; " />

          <view class="flex-column">
            <view class=" p-20 font-lg five-weight">{{gbDisInfo.gbDistributerName}}</view>
            <view class="p-10 status-unpaid font-xs text-center radius-20" bind:tap="requestSubscribeMessage"> è®¢é˜…é€šçŸ¥</view>
          </view>
         
        </view>

        <view class="month-section" wx:for="{{arr}}" wx:for-item="month" wx:for-index="index">
          <view class="month-container" wx:if="{{month.arr.length > 0}}">
            <!-- æœˆä»½æ±‡æ€»å¡ç‰‡ -->
            <view class="month-summary-card">
              <view class="month-header">
                <view class="month-title">{{month.month}}æœˆè´¦å•æ±‡æ€»</view>
                <view class="month-icon">ğŸ“Š</view>
              </view>

              <!-- è®¢å•ç»Ÿè®¡ -->
              <view class="supplier-stats">
                <view class="supplier-stat-item" catch:tap="toSupplierDetail" data-item="{{supplier}}" data-type="all" data-month="{{month.month}}">
                  <text class="supplier-stat-label">å…¨éƒ¨è®¢å•</text>
                  <text class="supplier-stat-count">{{month.itemData.billCount}}å•</text>
                  <text class="supplier-stat-value stat-value-primary">Â¥{{month.itemData.billTotal}}</text>
                </view>
                <view class="supplier-stat-item" catch:tap="toSupplierDetail" data-item="{{supplier}}" data-type="allUnPay" data-month="{{month.month}}">
                  <text class="supplier-stat-label">æœªç»“è´¦</text>
                  <text class="supplier-stat-count">{{month.itemData.actBillCount}}å•</text>
                  <text class="supplier-stat-value stat-value-primary">Â¥{{month.itemData.actPayTotal}}</text>
                </view>
              </view>

              <!-- ä»˜æ¬¾è¯¦æƒ… -->
              <view class="payment-detail">
                <view class="payment-item" catch:tap="toSupplierDetail" data-item="{{supplier}}" data-type="havePayed" data-month="{{month.month}}">
                  <text class="payment-label">å·²ç»“è´¦æ¬¾</text>
                  <text class="supplier-stat-count">{{month.itemData.havePayCount}}å•</text>
                  <text class="payment-value payment-success">Â¥{{month.itemData.havePayTotal}}</text>
                </view>
                <view class="payment-item" catch:tap="toSupplierDetail" data-item="{{supplier}}" data-type="unPayBills" data-month="{{month.month}}">
                  <text class="payment-label">æœªç»“è®¢å•</text>
                  <text class="supplier-stat-count">{{month.itemData.unPayCount}}å•</text>
                  <text class="payment-value stat-value-primary">Â¥{{month.itemData.unPayTotal}}</text>
                </view>
                <view class="payment-item" wx:if="{{month.itemData.returnBillCount > 0}}" catch:tap="toSupplierDetail" data-item="{{supplier}}" data-type="unPayReturnBills" data-month="{{month.month}}">
                  <text class="payment-label">é€€è´§å•</text>
                  <text class="payment-count payment-danger">{{month.itemData.returnBillCount}}å•</text>
                  <text class="payment-value payment-danger">Â¥{{month.itemData.returnPayTotal}}</text>
                </view>
              </view>

            </view>


             <!-- è®¢å•åˆ—è¡¨å®¹å™¨ -->
             <view class="supplier-bills-container" wx:if="{{gbDisInfo !== null}}">
               
               <view class="supplier-bill-item" wx:for="{{month.arr}}" wx:for-item="item" wx:key="gbDpbId" hover-class="supplier-bill-hover" bindtap="supplierOpenBatchDetailGb" data-item="{{item}}">
                 
                 <!-- è®¢å•ç±»å‹æ ‡ç­¾ -->
                 <view class="bill-type-section">
                   <view class="bill-type-tag">
                     <text class="bill-type-text tag-return" wx:if="{{item.gbDpbPurchaseType == 9}}">é€€è´§å•</text>
                     <text class="bill-type-text tag-auto" wx:elif="{{item.gbDpbPurchaseType == 21}}">è‡ªåŠ¨è®¢è´§</text>
                     <text class="bill-type-text tag-purchase" wx:else="">é‡‡è´­å‘˜è®¢è´§</text>
                   </view>
                   <view class="bill-arrow-section">
                     <image src="../../../../images/arrow-right-3.png" class="bill-arrow-icon"></image>
                   </view>
                 </view>

                 <!-- è®¢å•ä¸»è¦ä¿¡æ¯ -->
                 <view class="bill-main-info">
                   <view class="bill-date-section">
                     <text class="bill-date-text">{{item.gbDpbDate}}</text>
                     <text class="bill-weekday-text">{{item.gbDpbPurchaseWeek}}</text>
                   </view>
                   <view class="bill-right-section">
                     <view class="bill-amount-section" wx:if="{{item.gbDpbSubtotal > 0}}">
                       <text class="bill-amount-value">Â¥{{item.gbDpbSubtotal}}</text>
                       <text class="bill-amount-label">è®¢è´§é‡‘é¢</text>
                     </view>
                     <view class="bill-status-section">
                       <!-- æœªè¯»çŠ¶æ€ -->
                       <view class="status-badge status-unread" wx:if="{{item.gbDpbStatus == -1}}">æœªè¯»</view>
                       <!-- å¤‡è´§ä¸­çŠ¶æ€ -->
                       <view class="status-badge status-preparing" wx:elif="{{item.gbDpbStatus == 0 || item.gbDpbStatus == 1}}">å¤‡è´§ä¸­</view>
                       <!-- å¾…æ”¶è´§çŠ¶æ€ -->
                       <view class="status-badge status-pending" wx:elif="{{item.gbDpbStatus == 2}}">å¾…æ”¶è´§</view>
                       <!-- æœªä»˜æ¬¾çŠ¶æ€ -->
                       <view class="status-badge status-unpaid" wx:elif="{{item.gbDpbStatus == 3}}">æœªä»˜æ¬¾</view>
                       <!-- ä»˜æ¬¾å®ŒæˆçŠ¶æ€ -->
                       <view class="status-badge status-settled" wx:elif="{{item.gbDpbStatus == 4}}">ä»˜æ¬¾å®Œæˆ</view>
                     </view>
                   </view>
                 </view>

               </view>

             </view>
          </view>
        </view>

        <view class="text-secondary font-xs p-20  " style="text-align:center; height: 200rpx; line-height: 200rpx;">æ˜¾ç¤ºæœ€è¿‘3ä¸ªæœˆçš„è´¦å•</view>
        <!-- ../ -->
      </view>


    </view>
  </scroll-view>


</view>

<!-- é®ç½©å±‚ï¼Œå½“èœå•æ‰“å¼€æ—¶æ˜¾ç¤º -->
<view wx:if="{{menuOpen}}" class="aaa" style="width: {{windowWidth}}rpx; height: {{windowHeight}}rpx; background-color: rgba(0, 0, 0, 0.5); position: absolute; top: 0; left: 0;  z-index: 10500;" bindtap="toggleMenu"></view>
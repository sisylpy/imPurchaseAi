<import src='../../../../template/billPay/billPay.wxml' />

<wxs src="../../../../utils/fn.wxs" module="tool" />

<view class="flex-column">
  <view class="top_img_fixed flex-row" style="width: 100%; height: 110rpx; line-height: 110rpx; padding-top: {{statusBarHeight}}rpx; ">
    <image src="../../../../images/back-2.png" class="back_icon" bindtap="toBack"></image>
    <text class="top_bar_title">账单</text>
  </view>
  <image src="../../../../images/top.png" style="width: 100%; height: {{110 + statusBarHeight}}rpx;"></image>
</view>


<view class="flex-column">
 <!-- emptyView -->
 <view class="{{arr.length == 0  ? 'show' : 'hide'}}" style="height: {{windowHeight - 260}}rpx; text-align:center;">
        <view class="normal  empty_view">
          <view class="flex-column-center">
            <image class="empty_image" src="../../../../images/file-common.png"></image>
            <text class="big">现在没有账单</text>
            <text class="small gray with-tb-padding"></text>
          </view>
        </view>
      </view>
      <!-- ./emptyView -->    

    <!-- 订单列表 -->
    <view class="bill-list">
      <view class="bill-item" wx:for="{{arr}}" wx:for-item="item" wx:for-index="index" wx:key="gbDpbId">
        
        <!-- 选择框 -->
        <view class="bill-checkbox">
          <switch type="checkbox" checked="{{item.isSelect}}" bindchange="selectBill" data-index="{{index}}" />
        </view>
        
        <!-- 订单内容 -->
        <view class="bill-content" hover-class="bill-hover" bindtap="openBatchDetail" data-item="{{item}}">
          
          <!-- 订单头部信息 -->
          <view class="bill-header">
            <view class="bill-number">{{index + 1}}</view>
            <view class="bill-date-section">
              <view class="bill-date">{{item.gbDpbDate}}</view>
              <view class="bill-week">{{item.gbDpbPurchaseWeek}}</view>
            </view>
            <view class="bill-type-tag" wx:if="{{item.gbDpbPurchaseType == 9}}">退货</view>
          </view>
          
          <!-- 订单金额和箭头 -->
          <view class="bill-amount-section">
            <view class="bill-amount">{{item.gbDpbSubtotal}}元</view>
            <image src="../../../../images/arrow-right-3.png" class="bill-arrow"></image>
          </view>
          
        </view>
        
      </view>
    </view>

</view>





<!-- 结账确认弹窗 -->
<view class="modal-overlay {{isTishi ? 'modal-show' : 'modal-hide'}}" bindtap="closeMask">
  <view class="modal-container" catchtap="">
    
    <!-- 弹窗头部 -->
    <view class="modal-header">
      <view class="modal-icon">
        <image src="../../../../images/aixin.png" class="modal-icon-img"></image>
      </view>
      <view class="modal-title">结账确认</view>
    </view>
    
    <!-- 弹窗内容 -->
    <view class="modal-content">
      <view class="modal-message">
        <text class="modal-text-primary">客户已完成付款</text>
        <text class="modal-text-warning">结账确认以后，订单状态不可修改！</text>
      </view>
    </view>
    
    <!-- 弹窗按钮 -->
    <view class="modal-actions">
      <view class="modal-btn modal-btn-cancel" bindtap="cancleSettle">
        <text class="modal-btn-text">取消</text>
      </view>
      <view class="modal-btn modal-btn-confirm" bindtap="settleAccount">
        <text class="modal-btn-text">确定结账</text>
      </view>
    </view>
    
  </view>
</view>


<template is="billPay" data='{{selAmount:selAmount, total: total}}'></template>
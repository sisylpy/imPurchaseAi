<wxs src="../../../../utils/fn.wxs" module="tool" />


<view class="flex flex-column">


  <search-navbar style="height: {{navBarHeight}}rpx;" avatar="/images/back-gray.png" button-text="è®¾ç½®" bindnavbuttontap="toBack" bindtoSearchGoods="toSearchGoods"></search-navbar>


  <view class="flex-column mt-30">
    <!-- empty -->
    <view class="flex-column {{disGoodsArrAi.length == 0  ? 'show' : 'hide'}}" style="height: {{windowHeight - 360}}rpx; ">
      <view class="center-content" style="margin-top: 300rpx;">
        <view class="flex-column center-content">
          <image class="empty_image" src="../../../images/xiuxi.png"></image>
          <text class="big">æš‚æ— å•†å“</text>
          <view class="text-secondary font-sl">æ˜¾ç¤ºä¸‹å•æˆåŠŸçš„å•†å“ã€‚</view>
        </view>
      </view>
    </view>
    <!-- ./empty -->

    <view class="flex-row-default" wx:if="{{disGoodsArrAi.length > 0}}">

      <!-- å·¦ä¾§èœå• -->
      <view class="left">
        <scroll-view id="leftScrollDep" scroll-y="true" style="height: {{windowHeight - 200 - statusBarHeight}}rpx; " scroll-top="{{leftScrollTop}}" scroll-with-animation show-scrollbar="false">
          <view class="left-item {{selectedSub == index ? 'left-active' : ''}}" wx:for="{{disGoodsCataArr}}" wx:key="gbDistributerFatherGoodsId" id="left-cat-{{grand.gbDistributerFatherGoodsId}}" wx:for-item="grand" bindtap="leftMenuClickDep" data-index="{{index}}" data-id="{{grand.gbDistributerFatherGoodsId}}" data-name="{{grand.gbDfgFatherGoodsName}}">
            <view class="flex-column-center">
              <view class="picView ">
                <image src="{{url + grand.gbDfgFatherGoodsImg}}" mode="aspectFill" class="itemPic" />
              </view>
              <view class="extremeSmall text_center">
                <text>{{grand.gbDfgFatherGoodsName}}</text>
              </view>
            </view>
          </view>
        </scroll-view>
      </view>

      <!-- å³ä¾§å†…å®¹ -->
      <view class="flex-column">

        <view wx:if="{{showAllSubCatDep}}">

          <scroll-view scroll-y="true" class="subcat-popup" style="top: {{navBarHeight}}rpx; max-height: {{windowHeight - navBarHeight - 400}}rpx; width: {{windowWidth -80}}rpx; ">
            <view class="subcat-bar expand">
              <view class="subcat-tag {{activeSubCatIdDep == item.gbDistributerFatherGoodsId ? 'active' : ''}}" wx:for="{{fatherArr}}" wx:key="gbDistributerFatherGoodsId" bindtap="onSubCatTapDep" data-id="{{item.gbDistributerFatherGoodsId}}">
                {{item.gbDfgFatherGoodsName}}
              </view>
            </view>
          </scroll-view>
          <view class="subcat-mask" catchtouchmove="stopScroll" bindtap="toggleSubCatDep"></view>
        </view>

        <!-- æ”¶èµ·æ—¶æ¨ªå‘æ»šåŠ¨ -->
        <view class="flex-row" style="width: {{windowWidth - 140}}rpx;" wx:else>
          <scroll-view class="subcat-bar-scroll" scroll-x="true" scroll-into-view="{{subcatScrollIntoViewDep}}" scroll-with-animation show-scrollbar="false" style="width:{{windowWidth - 240}}rpx; margin-right: 20rpx; ">
            <block wx:for="{{fatherArr}}" wx:key="gbDistributerFatherGoodsId">
              <view class="subcat-tag {{activeSubCatIdDep == item.gbDistributerFatherGoodsId ? 'active' : ''}}" id="subcat-dep-{{item.gbDistributerFatherGoodsId}}" bindtap="onSubCatTapDep" data-id="{{item.gbDistributerFatherGoodsId}}">
                {{item.gbDfgFatherGoodsName}}
              </view>
            </block>
          </scroll-view>

          <view class="subcat-toggle" bindtap="toggleSubCatDep">
            <image src="../../images/arrow-down.svg" class="toggle-icon" />
          </view>
        </view>

        <scroll-view scroll-y="true" scroll-with-animation="true" bindscroll="onGoodsScrollDep" bindscrolltolower="onReachBottomDep" scroll-into-view="{{scrollIntoViewDep}}" scroll-top="{{depGoodsScrollTop}}" style="width: {{windowWidth - 160}}rpx; height: {{windowHeight - 200- statusBarHeight}}rpx; " class="goods-list-dep">

          <view class="flex-column  goods-item-dep-wrap" wx:for="{{disGoodsArrAi}}" wx:for-item="goods" wx:key="gbDepartmentDisGoodsId" wx:for-index="depGoodsIndex">
            <view wx:if="{{goods.isFirstInCategory}}" id="cat-dep-{{goods.gbDgDfgGoodsGrandId}}" class="goods-category-title-dep"></view>
            <view class="flex-row-default  goods-item-dep p-20" id="{{goods.viewId}}">
              <view class="img-wrapper">
                <image bindtap="showDialogBtnDep" data-item="{{goods}}" src="{{goods.gbDgNxFatherImg !== null ? url + goods.gbDgNxFatherImg : '/images/logo.jpg'}}" mode="aspectFill" class="dep_goods_url mr-20" />
              </view>

              <view class="flex-row">
                <view class="flex-column" style="width: {{windowWidth - 360}}rpx;">
                  <view class="flex-row">
                    <text class="font-bold font-lg-2">{{goods.gbDgGoodsName}}</text>
                    <block wx:if="{{goods.gbDgControlFresh == 1}}">
                                <text class="fresh_goods">ä¿é²œ{{goods.gbDgFreshWasteHour}}å°æ—¶</text>
                              </block>
                  </view>
                  <view class="flex-row font-sm" wx:if="{{goods.gbDgGoodsStandardWeight.length > 0}}">
                    <view class="flex-row">
                      <text class="gray">è§„æ ¼:</text>
                      <block wx:if="{{goods.gbDistributerGoodsEntity.gbDgGoodsStandardWeight.length > 0}}">
                        <view class="" wx:if="{{goods.gbDistributerGoodsEntity.gbDgGoodsStandardname !== 'æ–¤'}}">
                          {{goods.gbDistributerGoodsEntity.gbDgGoodsStandardWeight}}/{{goods.gbDistributerGoodsEntity.gbDgGoodsStandardname}}
                        </view>
                      </block>

                      <block wx:else>
                        <text class="">{{goods.gbDistributerGoodsEntity.gbDgGoodsStandardname}}</text>
                      </block>
                    </view>
                  </view>

                  <view class="flex-row">
                    <text class="mr-20">ğŸ›’</text>
                    <text class="mr-10 font-sm">å½“å‰:</text>
                    <text class="mainColor font-lg"> {{goods.goodsStockWeightTotalString}}</text>
                    <text class=""> {{goods.gbDgGoodsStandardname}}</text>
                  </view>

                  <view class="flex-row-between">
                     <view class="flex-row">
                      <text class="mr-10 font-sm">åº“å­˜é‡‘é¢:</text>
                    <text class="mainColor font-lg"> {{goods.goodsStockTotalString}}</text>
                    <text class="">å…ƒ</text>
                     </view>

                     <image src="/images/arrow-right-3.png" mode="aspectFill" class="icon {{goods.arrowRotated ? 'rotated' : ''}}" bind:tap="showData" data-index="{{depGoodsIndex}}"/>
                    
                  </view>

                </view>
              </view>

            </view>

            <!-- å±•å¼€çš„è¯¦æƒ…å†…å®¹åŒºåŸŸ -->
            <view class="goods-detail-content" animation="{{goods.animation}}">
              <view class="detail-inner" wx:if="{{goods.isSelected}}">
                <view class="flex-row font-sm">
                  <text class="mr-20">ğŸ’°</text>
                  <text class="mr-10 ">æœ¬æœˆæ€»æˆæœ¬:</text>
                  <text class=""> {{goods.goodsData.thisMonthSubtotal}}å…ƒ</text>
                </view>

                <view class="flex-row font-sm">
                  <text class="mr-20">ğŸ“Š</text>
                  <text class="mr-10">å {{goods.goodsData.grandName}}æ€»æˆæœ¬:</text>
                  <text class=""> {{goods.goodsData.grandPercent}}%</text>
                </view>
                <view class="flex-row font-sm">
                  <text class="mr-20">ğŸ¬</text>
                  <text class="mr-10">å å…¨åº—æ€»æˆæœ¬:</text>
                  <!-- storePercent -->
                  <text class=""> {{goods.goodsData.storePercent}}%</text>
                </view>
                <view class="flex-row font-sm">
                  <text class="mr-20">ğŸ·ï¸</text>
                  <text class="mr-10">å½“å‰é‡‡è´­ä»·:</text>
                  <text class=""> {{goods.goodsData.purPrice}}å…ƒ/{{goods.gbDgGoodsStandardname}}</text>
                  <text class=""> </text>
                </view>

                <view class="flex-row font-sm">
                  <text class="mr-20">ğŸ“ˆ</text>
                  <text class="mr-10">30æ—¥å†…å‡ä»·:</text>
                  <text class=""> {{goods.goodsData.thirtyPurPrice}}/{{goods.gbDgGoodsStandardname}}</text>
                  <text class=""> </text>
                </view>
                <view class="flex-row font-sm">
                  <text class="mr-20">âš ï¸</text>
                  <text class="mr-10">30æ—¥å†…æŸè€—ç‡:</text>
                  <text class=""> {{goods.goodsData.lossPercent}}%</text>
                  <text class=""> </text>
                </view>
              </view>
            </view>

            <view class="flex-row font-sm text-secondary ">

              <view class="flex-row  p-10 center-content flex-column-center" hover-class="hover" bind:tap="toGoods" data-id="{{goods.gbDistributerGoodsId}}" data-goods="{{goods}}">
                <image src="/images/shuiguoshucai-2.png" mode="aspectFill" class="icon-m-lg" />
              </view>

              <view class="flex-row  p-10 center-content flex-column-center" hover-class="hover" bind:tap="toFenxi" data-id="{{goods.gbDistributerGoodsId}}">
                <image src="/images/time-2.png" mode="aspectFill" class="icon-m-lg" />
              </view>

              <view class="flex-column center-content flex-column-center">
                <view class="flex-row  p-10" bind:tap="toBusiness" data-id="{{goods.gbDistributerGoodsId}}" data-goods="{{goods}}" hover-class="hover">
                  <image src="/images/goods-3.png" mode="aspectFill" class="icon-m-lg" />
                  <!-- <view class="">åº“å­˜</view> -->
                </view>
              </view>


            </view>

          </view>

          <!-- æ·»åŠ åº•éƒ¨ç©ºç™½åŒºåŸŸï¼Œç¡®ä¿æœ€åä¸€ä¸ªå•†å“ä¹Ÿèƒ½è§¦å‘è”åŠ¨ -->
          <view wx:if="{{totalPages == currentPage}}" style="height: {{windowHeight  / 2}}rpx;"></view>
        </scroll-view>

      </view>


    </view>

  </view>

</view>


<view class='overlay {{showOperation ? "show" : "hiede"}}' catchtap="hideMask">

  <view class=" bg-white" wx:if="{{deleteShow}}" style="margin-top:{{200 + navBarHeight}}rpx;margin-left: 50rpx; width:{{windowWidth - 100}}rpx;">
    <view class="flex-cloumn">

      <view class="weight_five  p-20 delBack" style="text-align: center;">
        <view class="p-20 font-md">åˆ é™¤è®¢è´§</view>
      </view>
      <view class="flex-row p-20 normal">
        <view class="mr-20 p-20">{{itemDis.gbDgGoodsName}}</view>
        <view class="p-20">è®¢è´§: {{applyItem.gbDoQuantity}}{{applyItem.gbDoStandard}}</view>
      </view>
    </view>

    <view class="flex-row" style="padding-bottom: 40rpx; margin-top: 20rpx;">
      <view class="p-20 half-row cancel-btn" style="margin-left: 5%; " bindtap="deleteNo" hover-class="hover">å–æ¶ˆ</view>
      <view class="p-20 half-row confirm-btn" bindtap="deleteYes" hover-class="hover" style="margin-left: 10%; ">ç¡®å®š</view>
    </view>

  </view>


</view>


<myDismodal show="{{show}}" bindconfirm="confirm" bindcancle="cancle" binddelApply="delApply" binddelStandard="delStandard" bindconfirmStandard="confirmStandard" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" hasStock="{{hasStock}}" applySubtotal="{{applySubtotal}}" applyRemark="{{applyRemark}}" editApply="{{editApply}}" expectPrice="{{expectPrice}}" navBarHeight="{{navBarHeight}}" windowWidth="{{windowWidth}}" bindchangeStandard="changeStandard" applyGoodsName="{{applyGoodsName}}" applyGoodsId="{{applyGoodsId}}" item="{{itemDis}}" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" canSave="{{canSave}}" windowWidth="{{windowWidth}}" windowHeight="{{windowHeight}}" />



<myDismodalNx show="{{showNx}}" bindconfirm="confirm" bindcancle="cancle" binddelApply="delApply" bindconfirmStandardNx="confirmStandardNx" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" applySubtotal="{{applySubtotal}}" applyRemark="{{applyRemark}}" editApply="{{editApply}}" expectPrice="{{expectPrice}}" navBarHeight="{{navBarHeight}}" windowWidth="{{windowWidth}}" bindchangeStandard="changeStandard" applyGoodsName="{{applyGoodsName}}" applyGoodsId="{{applyGoodsId}}" item="{{gbGoods}}" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" canSave="{{canSave}}" windowWidth="{{windowWidth}}" windowHeight="{{windowHeight}}" />

<delWarnModal wx:if="{{showPopupWarn}}" type="{{popupType}}" warnContent="{{warnContent}}" bind:closeWarn="closeWarn" bind:confirmWarn="confirmWarn" />


<myIndependent show="{{showInd}}" url="{{url}}" item="{{item}}" windowHeight="{{windowHeight}}" windowWidth="{{windowWidth}}" />


<myIndependentNx show="{{showIndNx}}" url="{{url}}" item="{{item}}" windowHeight="{{windowHeight}}" windowWidth="{{windowWidth}}" />


<myDismodalStand show="{{showStand}}" bindconfirm="confirm" bindcancle="cancle" applyStandardName="{{applyStandardName}}" applyNumber="{{applyNumber}}" applyRemark="{{applyRemark}}" editApply="{{editApply}}" bindchangeStandard="changeStandard" applyGoodsName="{{applyGoodsName}}" applyGoodsId="{{applyGoodsId}}" item="{{itemCom}}" applyStandardName="{{applyStandardName}}" applyPrice="{{applyPrice}}" applyStandardId="{{applyStandardId}}" expectPrice="{{expectPrice}}" applyStandardScale="{{applyStandardScale}}" applyStandardQuantity="{{applyStandardQuantity}}" />



<cover-view class="modal-mask" bindtap="hideModal" wx:if="{{showGoodsModal}}"></cover-view>
<cover-view class="modal-dialog" wx:if="{{showGoodsModal}}">
  <cover-view class="modal-title">{{item.gbGoodsName}}</cover-view>
  <cover-view>{{url + item.gbGoodsFileLarge}}</cover-view>
  <cover-view class="modal-content">
    <cover-image style="width: 400rpx; height: 500rpx;" src="{{url + item.gbGoodsFileLarge}}"></cover-image>
  </cover-view>

</cover-view>



<stockGoods show="{{showStock}}" bindconfirm="confirmStock" item="{{item}}" disGoods="{{disGoods}}" bindcancle="cancle" modalHeight="{{windowHeight > maskHeight ? windowHeight : maskHeight }}" scrollViewTop="{{scrollViewTop}}" windowHeight="{{windowHeight}}" windowWidth="{{windowWidth}}" consultItem="{{item}}" nowTime="{{nowTime}}" src="{{src}}" reason="{{reason}}" canWaste="{{canWaste}}" canSure="{{canSure}}" showType="{{showType}}" resultTime="{{resultTime}}" />